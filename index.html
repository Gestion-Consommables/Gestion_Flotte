<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Flottes - Poste Guin√©enne</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Base Styles & Variables */
    :root {
      --primary-color: #3498db;
      --secondary-color: #2ecc71;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
      --text-color: #333;
      --text-light: #7f8c8d;
      --border-color: #ddd;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    [data-theme="dark"] {
      --primary-color: #2980b9;
      --secondary-color: #27ae60;
      --dark-color: #ecf0f1;
      --light-color: #2c3e50;
      --text-color: #ecf0f1;
      --text-light: #bdc3c7;
      --border-color: #34495e;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: #f5f7fa;
      transition: var(--transition);
    }

    [data-theme="dark"] body {
      background-color: #1a1a1a;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    .app-header {
      background-color: var(--dark-color);
      color: white;
      padding: 1rem 0;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }

    .app-header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Nouveaux styles pour le logo */
    .header-logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .header-logo {
      height: 50px;
      display: flex;
      align-items: center;
      background-color: #1a3a6d;
      padding: 0 15px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .logo-text {
      text-align: center;
      line-height: 1.2;
      font-weight: bold;
      color: white;
    }
    
    .logo-main {
      font-size: 18px;
      text-transform: uppercase;
    }
    
    .logo-sub {
      font-size: 14px;
    }
    
    .logo-slogan {
      font-size: 10px;
      color: #f9c642;
      margin-top: 2px;
    }

    .app-header h1 {
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    /* Tab Navigation */
    .nav-tabs {
      display: flex;
      gap: 5px;
      margin-right: 15px;
    }

    .nav-tab {
      padding: 8px 15px;
      background: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      color: white;
    }

    .nav-tab.active {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .nav-tab:not(.active):hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Grid Layout */
    .grid-layout {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 2rem;
    }

    /* Card Styles */
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: var(--transition);
    }

    [data-theme="dark"] .card {
      background-color: #252525;
    }

    .card-header {
      padding: 1rem;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h2 {
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      padding: 1rem;
    }

    /* Form Styles */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-color);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 1rem;
      transition: var(--transition);
      background-color: var(--light-color);
      color: var(--text-color);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .search-box {
      position: relative;
      width: 200px;
    }

    .search-box input {
      width: 100%;
      padding: 8px 30px 8px 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }

    .search-box i {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
    }

    /* Button Styles */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: #2980b9;
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background-color: #27ae60;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-color);
    }

    .btn-outline:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }

    /* Table Styles */
    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
    }

    tr:hover {
      background-color: rgba(0, 0, 0, 0.02);
    }

    [data-theme="dark"] tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      font-size: 0.9rem;
    }

    .pagination {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pagination button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--primary-color);
      font-size: 1rem;
    }

    .pagination button:disabled {
      color: var(--text-light);
      cursor: not-allowed;
    }

    /* Timeline Styles */
    .timeline {
      position: relative;
      padding-left: 30px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: var(--primary-color);
    }

    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -30px;
      top: 5px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: var(--primary-color);
    }

    .timeline-date {
      font-size: 0.8rem;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .timeline-content {
      background-color: var(--light-color);
      padding: 10px 15px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background-color: white;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .modal-content {
      background-color: #252525;
    }

    .modal-header {
      padding: 15px 20px;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 15px 20px;
      display: flex;
      justify-content: flex-end;
      border-top: 1px solid var(--border-color);
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: white;
    }

    /* Toast Styles */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--dark-color);
      color: white;
      padding: 15px 20px;
      border-radius: 4px;
      box-shadow: var(--shadow);
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition);
      z-index: 1100;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Bike Specific Styles */
    .bike-status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .bike-status.en-service {
      background-color: #d4edda;
      color: #155724;
    }

    .bike-status.en-panne {
      background-color: #f8d7da;
      color: #721c24;
    }

    .bike-status.en-maintenance {
      background-color: #fff3cd;
      color: #856404;
    }

    [data-theme="dark"] .bike-status.en-service {
      background-color: #155724;
      color: #d4edda;
    }

    [data-theme="dark"] .bike-status.en-panne {
      background-color: #721c24;
      color: #f8d7da;
    }

    [data-theme="dark"] .bike-status.en-maintenance {
      background-color: #856404;
      color: #fff3cd;
    }

    /* Vehicle/Bike Details in Modal */
    .detail-item {
      margin-bottom: 15px;
    }

    .detail-label {
      font-weight: 600;
      display: block;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .detail-value {
      display: block;
    }

    .full-width {
      width: 100%;
    }

    .maintenance-title {
      margin: 20px 0 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid var(--border-color);
    }

    .maintenance-item {
      padding: 10px;
      margin-bottom: 10px;
      background-color: var(--light-color);
      border-radius: 4px;
    }

    .maintenance-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .maintenance-type {
      font-weight: 600;
    }

    .maintenance-date {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .maintenance-cost {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .maintenance-description {
      font-size: 0.9rem;
    }

    /* Utility Classes */
    .mb-3 { margin-bottom: 1rem; }
    .mt-3 { margin-top: 1rem; }
    .text-center { text-align: center; }
    .d-flex { display: flex; }
    .align-center { align-items: center; }
    .justify-between { justify-content: space-between; }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .app-header .container {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .header-logo-container {
        flex-direction: column;
        text-align: center;
      }
      
      .header-logo {
        margin-bottom: 10px;
      }
      
      .header-actions {
        width: 100%;
        justify-content: center;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .table-footer {
        flex-direction: column;
        gap: 15px;
      }
      
      .modal-content {
        width: 95%;
      }
    }

    @media (max-width: 480px) {
      .card-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .nav-tabs {
        margin-right: 0;
        margin-bottom: 10px;
      }
      
      .header-logo {
        height: 40px;
        padding: 0 10px;
      }
      
      .logo-main {
        font-size: 16px;
      }
      
      .logo-sub {
        font-size: 12px;
      }
      
      .logo-slogan {
        font-size: 9px;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="container">
      <div class="header-logo-container">
        <div class="header-logo">
          <!-- Logo La Poste Guin√©enne -->
          <div class="logo-text">
            <div class="logo-main">LA POSTE</div>
            <div class="logo-sub">GUIN√âENNE</div>
            <div class="logo-slogan">Confiance - Innovation - Proximit√©</div>
          </div>
        </div>
        <h1><i class="fas fa-truck-moving"></i> Gestion des Flottes</h1>
      </div>
      <div class="header-actions">
        <div class="nav-tabs">
          <button class="nav-tab active" data-tab="vehicles"><i class="fas fa-car"></i> V√©hicules</button>
          <button class="nav-tab" data-tab="bikes"><i class="fas fa-bicycle"></i> Motos/Tricycles</button>
          <button class="nav-tab" data-tab="generators"><i class="fas fa-bolt"></i> Groupes √âlectrog√®nes</button>
        </div>
        <button id="export-excel" class="btn btn-primary"><i class="fas fa-file-excel"></i> Exporter Excel</button>
        <button id="toggle-theme" class="btn btn-secondary"><i class="fas fa-moon"></i></button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Vehicles Tab Content -->
    <div id="vehicles-tab" class="tab-content active">
      <div class="grid-layout">
        <!-- Vehicle Form Section -->
        <section id="form-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-car"></i> Ajouter/Modifier un V√©hicule</h2>
            <button id="clear-form" class="btn btn-sm btn-outline">Nouveau</button>
          </div>
          <div class="card-body">
            <form id="vehicule-form" class="form-grid">
              <div class="form-group">
                <label for="immatriculation">Immatriculation</label>
                <input type="text" id="immatriculation" placeholder="Ex: ABC1234" required />
              </div>
              
              <div class="form-group">
                <label for="marque">Marque/Mod√®le</label>
                <input type="text" id="marque" placeholder="Ex: Toyota Hilux" required />
              </div>
              
              <div class="form-group">
                <label for="type">Type</label>
                <select id="type" required>
                  <option value="">S√©lectionner...</option>
                  <option value="voiture">Voiture</option>
                  <option value="camion">Camion</option>
                  <option value="bus">Bus</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <!-- Champ de date modifi√© pour accepter le format JJ MM AAAA -->
              <div class="form-group">
                <label for="date_circulation">Date de mise en circulation</label>
                <input type="text" id="date_circulation" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e (ex: 15 03 2020)</small>
              </div>
              
              <div class="form-group">
                <label for="statut">Statut</label>
                <select id="statut" required>
                  <option value="en service">En service</option>
                  <option value="en panne">En panne</option>
                  <option value="en maintenance">En maintenance</option>
                  <option value="hors service">Hors service</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="chauffeur">Chauffeur assign√©</label>
                <input type="text" id="chauffeur" placeholder="Nom et pr√©nom du chauffeur" />
              </div>
              
              <div class="form-group full-width">
                <label for="observations">Observations</label>
                <textarea id="observations" placeholder="Notes sur l'√©tat du v√©hicule"></textarea>
              </div>
              
              <!-- Section Gestion des D√©placements -->
              <div class="form-group">
                <label for="departement">D√©partement Utilisateur</label>
                <select id="departement" required>
                  <option value="">S√©lectionner...</option>
                  <option value="DG">Direction G√©n√©rale (DG)</option>
                  <option value="DGA">Direction G√©n√©rale Adjointe (DGA)</option>
                  <option value="DSI">Direction des Syst√®mes d'Information (DSI)</option>
                  <option value="DSP">Direction des Services Postaux (DSP)</option>
                  <option value="DRH">Direction des Ressources Humaines (DRH)</option>
                  <option value="DPLMG">Direction de la Logistique et Moyens G√©n√©raux (DPLMG)</option>
                  <option value="DSPS">Direction de la S√©curit√© et Protection Sociale (DSPS)</option>
                  <option value="DACQ">Direction des Achats (DACQ)</option>
                  <option value="DSJ">Direction des Services Juridiques (DSJ)</option>
                  <option value="DAF">Direction des Affaires Financi√®res (DAF)</option>
                </select>
              </div>

              <div class="form-group">
                <label for="destination">Destination</label>
                <input type="text" id="destination" placeholder="Lieu de destination" />
              </div>

              <div class="form-group">
                <label for="motif_deplacement">Motif du D√©placement</label>
                <input type="text" id="motif_deplacement" placeholder="Raison du d√©placement" />
              </div>

              <div class="form-group">
                <label for="km_avant">Kilom√©trage Avant D√©placement</label>
                <input type="number" id="km_avant" placeholder="Kilom√©trage au d√©part" />
              </div>

              <div class="form-group">
                <label for="km_apres">Kilom√©trage Apr√®s D√©placement</label>
                <input type="number" id="km_apres" placeholder="Kilom√©trage √† l'arriv√©e" />
              </div>

              <div class="form-group">
                <label for="km_parcouru">Kilom√©trage Parcouru (calcul√© automatiquement)</label>
                <input type="number" id="km_parcouru" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-actions full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
                <button type="button" id="cancel-edit" class="btn btn-outline">Annuler</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Fuel Section MODIFI√âE -->
        <section id="carburant-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-gas-pump"></i> Ravitaillement en carburant</h2>
          </div>
          <div class="card-body">
            <form id="carburant-form" class="form-grid">
              <div class="form-group">
                <label for="carburant_vehicule">V√©hicule</label>
                <select id="carburant_vehicule" required>
                  <option value="">S√©lectionner un v√©hicule...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="carburant_date">Date</label>
                <input type="text" id="carburant_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="carburant_km_depart">Kilom√©trage D√©part</label>
                <input type="number" id="carburant_km_depart" placeholder="Km au d√©part" required />
              </div>
              
              <div class="form-group">
                <label for="carburant_km_arrivee">Kilom√©trage Arriv√©e Station</label>
                <input type="number" id="carburant_km_arrivee" placeholder="Km √† l'arriv√©e station" required />
              </div>
              
              <div class="form-group">
                <label for="carburant_km_parcouru">Kilom√©trage Parcouru (calcul√©)</label>
                <input type="number" id="carburant_km_parcouru" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group">
                <label for="carburant_litres">Quantit√© Ravitaill√©e (L)</label>
                <input type="number" step="0.1" id="carburant_litres" placeholder="Ex: 45.5" required />
              </div>
              
              <!-- NOUVEAU CHAMP MODIFI√â : Consommation manuelle -->
              <div class="form-group">
                <label for="carburant_consommation_100km">Consommation sur 100 Km</label>
                <input type="number" step="0.1" id="carburant_consommation_100km" placeholder="Saisir la consommation" />
              </div>
              
              <div class="form-group">
                <label for="carburant_prix_unitaire">Prix Unitaire (GNF)</label>
                <input type="number" step="0.01" id="carburant_prix_unitaire" placeholder="Ex: 1250" required />
              </div>
              
              <div class="form-group">
                <label for="carburant_type">Type de carburant</label>
                <select id="carburant_type" required>
                  <option value="gasoil">Gasoil</option>
                  <option value="essence">Essence</option>
                  <option value="gnc">GNC</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="carburant_cout">Co√ªt Total (calcul√©)</label>
                <input type="number" step="0.01" id="carburant_cout" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Ravitaillement</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Vehicle Maintenance Section -->
        <section id="vehicle-maintenance-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-tools"></i> Maintenance des V√©hicules</h2>
          </div>
          <div class="card-body">
            <form id="vehicle-maintenance-form" class="form-grid">
              <div class="form-group">
                <label for="vehicle_maintenance_vehicule">V√©hicule</label>
                <select id="vehicle_maintenance_vehicule" required>
                  <option value="">S√©lectionner un v√©hicule...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="vehicle_maintenance_date">Date</label>
                <input type="text" id="vehicle_maintenance_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="vehicle_maintenance_type">Type de maintenance</label>
                <select id="vehicle_maintenance_type" required>
                  <option value="entretien_kilometrique">Entretien kilom√©trique</option>
                  <option value="freins">Freins</option>
                  <option value="pneus">Pneus</option>
                  <option value="climatisation">Climatisation</option>
                  <option value="electrique">Probl√®me √©lectrique</option>
                  <option value="moteur">Probl√®me de moteur</option>
                  <option value="carrosserie">Probl√®me de carrosserie</option>
                  <option value="suspension">Probl√®me de suspension</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="vehicle_maintenance_cout">Co√ªt (GNF)</label>
                <input type="number" step="0.01" id="vehicle_maintenance_cout" placeholder="Ex: 325000" required />
              </div>
              
              <div class="form-group full-width">
                <label for="vehicle_maintenance_description">Description</label>
                <textarea id="vehicle_maintenance_description" placeholder="D√©tails de la maintenance, pi√®ces remplac√©es..."></textarea>
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Maintenance</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Vehicles List -->
        <section id="vehicules-list" class="card">
          <div class="card-header">
            <h2><i class="fas fa-list"></i> Liste des V√©hicules</h2>
            <div class="search-box">
              <input type="text" id="search-vehicule" placeholder="Rechercher v√©hicule...">
              <i class="fas fa-search"></i>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="vehicules-table">
                <thead>
                  <tr>
                    <th>Immat.</th>
                    <th>Marque/Mod√®le</th>
                    <th>Type</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="liste-vehicules">
                  <!-- Donn√©es dynamiques -->
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info" id="vehicule-count">0 v√©hicules</div>
              <div class="pagination">
                <button id="prev-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="page-info">Page 1</span>
                <button id="next-page" disabled><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        </section>

        <!-- History Section -->
        <section id="historique-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-history"></i> Historique des Actions</h2>
            <div class="filter-actions">
              <select id="filter-type">
                <option value="all">Tous les types</option>
                <option value="vehicle">V√©hicules</option>
                <option value="fuel">Carburant</option>
                <option value="maintenance">Maintenance</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline" id="historique">
              <!-- Historique dynamique -->
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Bikes Tab Content -->
    <div id="bikes-tab" class="tab-content">
      <div class="grid-layout">
        <!-- Bike Form Section -->
        <section id="bike-form-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-bicycle"></i> Ajouter/Modifier une Moto/Tricycle</h2>
            <button id="clear-bike-form" class="btn btn-sm btn-outline">Nouveau</button>
          </div>
          <div class="card-body">
            <form id="bike-form" class="form-grid">
              <div class="form-group">
                <label for="bike_immatriculation">Immatriculation</label>
                <input type="text" id="bike_immatriculation" placeholder="Ex: MOTO1234" required />
              </div>
              
              <div class="form-group">
                <label for="bike_marque">Marque/Mod√®le</label>
                <input type="text" id="bike_marque" placeholder="Ex: Yamaha XTZ" required />
              </div>
              
              <div class="form-group">
                <label for="bike_type">Type</label>
                <select id="bike_type" required>
                  <option value="">S√©lectionner...</option>
                  <option value="moto_cross">Moto Cross</option>
                  <option value="moto_routiere">Moto Routi√®re</option>
                  <option value="scooter">Scooter</option>
                  <option value="tricycle">Tricycle</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <!-- Champ de date modifi√© pour accepter le format JJ MM AAAA -->
              <div class="form-group">
                <label for="bike_date_circulation">Date de mise en circulation</label>
                <input type="text" id="bike_date_circulation" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e (ex: 15 03 2020)</small>
              </div>
              
              <div class="form-group">
                <label for="bike_statut">Statut</label>
                <select id="bike_statut" required>
                  <option value="en service">En service</option>
                  <option value="en panne">En panne</option>
                  <option value="en maintenance">En maintenance</option>
                  <option value="hors service">Hors service</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_chauffeur">Livreur assign√©</label>
                <input type="text" id="bike_chauffeur" placeholder="Nom et pr√©nom du livreur" />
              </div>
              
              <div class="form-group full-width">
                <label for="bike_observations">Observations</label>
                <textarea id="bike_observations" placeholder="Notes sur l'√©tat de la moto/tricycle"></textarea>
              </div>
              
              <div class="form-actions full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
                <button type="button" id="cancel-bike-edit" class="btn btn-outline">Annuler</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Bike Fuel Section -->
        <section id="bike-fuel-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-gas-pump"></i> Ravitaillement Moto/Tricycle</h2>
          </div>
          <div class="card-body">
            <form id="bike-fuel-form" class="form-grid">
              <div class="form-group">
                <label for="bike_fuel_bike">Moto/Tricycle</label>
                <select id="bike_fuel_bike" required>
                  <option value="">S√©lectionner une moto/tricycle...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_fuel_date">Date</label>
                <input type="text" id="bike_fuel_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="bike_fuel_litres">Quantit√© Ravitaill√©e (L)</label>
                <input type="number" step="0.1" id="bike_fuel_litres" placeholder="Ex: 8.5" required />
              </div>
              
              <div class="form-group">
                <label for="bike_fuel_prix_unitaire">Prix Unitaire (GNF)</label>
                <input type="number" step="0.01" id="bike_fuel_prix_unitaire" placeholder="Ex: 1250" required />
              </div>
              
              <div class="form-group">
                <label for="bike_fuel_type">Type de carburant</label>
                <select id="bike_fuel_type" required>
                  <option value="essence">Essence</option>
                  <option value="gasoil">Gasoil</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_fuel_cout">Co√ªt Total (calcul√©)</label>
                <input type="number" step="0.01" id="bike_fuel_cout" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Ravitaillement</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Bike Maintenance Section -->
        <section id="bike-maintenance-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-tools"></i> Maintenance Moto/Tricycle</h2>
          </div>
          <div class="card-body">
            <form id="bike-maintenance-form" class="form-grid">
              <div class="form-group">
                <label for="bike_maintenance_bike">Moto/Tricycle</label>
                <select id="bike_maintenance_bike" required>
                  <option value="">S√©lectionner une moto/tricycle...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_maintenance_date">Date</label>
                <input type="text" id="bike_maintenance_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="bike_maintenance_type">Type de maintenance</label>
                <select id="bike_maintenance_type" required>
                  <option value="vidange">Vidange</option>
                  <option value="freins">Freins</option>
                  <option value="pneus">Pneus</option>
                  <option value="chaine">Cha√Æne</option>
                  <option value="bougie">Bougie</option>
                  <option value="filtre_air">Filtre √† air</option>
                  <option value="electrique">Probl√®me √©lectrique</option>
                  <option value="moteur">Probl√®me de moteur</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_maintenance_cout">Co√ªt (GNF)</label>
                <input type="number" step="0.01" id="bike_maintenance_cout" placeholder="Ex: 75000" required />
              </div>
              
              <div class="form-group full-width">
                <label for="bike_maintenance_description">Description</label>
                <textarea id="bike_maintenance_description" placeholder="D√©tails de la maintenance, pi√®ces remplac√©es..."></textarea>
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Maintenance</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Bikes List -->
        <section id="bikes-list" class="card">
          <div class="card-header">
            <h2><i class="fas fa-list"></i> Liste des Motos/Tricycles</h2>
            <div class="search-box">
              <input type="text" id="search-bike" placeholder="Rechercher moto/tricycle...">
              <i class="fas fa-search"></i>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="bikes-table">
                <thead>
                  <tr>
                    <th>Immat.</th>
                    <th>Marque/Mod√®le</th>
                    <th>Type</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="liste-bikes">
                  <!-- Donn√©es dynamiques -->
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info" id="bike-count">0 motos/tricycles</div>
              <div class="pagination">
                <button id="prev-bike-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="bike-page-info">Page 1</span>
                <button id="next-bike-page" disabled><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        </section>

        <!-- Bike History Section -->
        <section id="bike-history-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-history"></i> Historique des Actions Moto/Tricycle</h2>
            <div class="filter-actions">
              <select id="bike-filter-type">
                <option value="all">Tous les types</option>
                <option value="bike">Motos/Tricycles</option>
                <option value="fuel">Carburant</option>
                <option value="maintenance">Maintenance</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline" id="bike-historique">
              <!-- Historique dynamique -->
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Generators Tab Content -->
    <div id="generators-tab" class="tab-content">
      <div class="grid-layout">
        <!-- Generator Form Section -->
        <section id="generator-form-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-bolt"></i> Ajouter/Modifier un Groupe √âlectrog√®ne</h2>
            <button id="clear-generator-form" class="btn btn-sm btn-outline">Nouveau</button>
          </div>
          <div class="card-body">
            <form id="generator-form" class="form-grid">
              <div class="form-group">
                <label for="generator_numero">Num√©ro d'inventaire</label>
                <input type="text" id="generator_numero" placeholder="Ex: GE-001" required />
              </div>
              
              <div class="form-group">
                <label for="generator_marque">Marque/Mod√®le</label>
                <input type="text" id="generator_marque" placeholder="Ex: Honda EU70is" required />
              </div>
              
              <div class="form-group">
                <label for="generator_puissance">Puissance (kVA)</label>
                <input type="number" step="0.1" id="generator_puissance" placeholder="Ex: 7.5" required />
              </div>
              
              <div class="form-group">
                <label for="generator_date_acquisition">Date d'acquisition</label>
                <input type="text" id="generator_date_acquisition" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="generator_statut">Statut</label>
                <select id="generator_statut" required>
                  <option value="fonctionnel">Fonctionnel</option>
                  <option value="en_panne">En panne</option>
                  <option value="en_maintenance">En maintenance</option>
                  <option value="hors_service">Hors service</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_localisation">Localisation</label>
                <input type="text" id="generator_localisation" placeholder="Ex: Si√®ge, Direction..." />
              </div>
              
              <div class="form-group full-width">
                <label for="generator_observations">Observations</label>
                <textarea id="generator_observations" placeholder="Notes sur l'√©tat du groupe √©lectrog√®ne"></textarea>
              </div>
              
              <div class="form-actions full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
                <button type="button" id="cancel-generator-edit" class="btn btn-outline">Annuler</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Generator Fuel Section -->
        <section id="generator-fuel-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-gas-pump"></i> Ravitaillement Groupe √âlectrog√®ne</h2>
          </div>
          <div class="card-body">
            <form id="generator-fuel-form" class="form-grid">
              <div class="form-group">
                <label for="generator_fuel_generator">Groupe √âlectrog√®ne</label>
                <select id="generator_fuel_generator" required>
                  <option value="">S√©lectionner un groupe...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_fuel_date">Date</label>
                <input type="text" id="generator_fuel_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="generator_fuel_litres">Quantit√© Ravitaill√©e (L)</label>
                <input type="number" step="0.1" id="generator_fuel_litres" placeholder="Ex: 20.0" required />
              </div>
              
              <div class="form-group">
                <label for="generator_fuel_prix_unitaire">Prix Unitaire (GNF)</label>
                <input type="number" step="0.01" id="generator_fuel_prix_unitaire" placeholder="Ex: 1250" required />
              </div>
              
              <div class="form-group">
                <label for="generator_fuel_type">Type de carburant</label>
                <select id="generator_fuel_type" required>
                  <option value="gasoil">Gasoil</option>
                  <option value="essence">Essence</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_fuel_cout">Co√ªt Total (calcul√©)</label>
                <input type="number" step="0.01" id="generator_fuel_cout" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Ravitaillement</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Generator Maintenance Section -->
        <section id="generator-maintenance-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-tools"></i> Maintenance Groupe √âlectrog√®ne</h2>
          </div>
          <div class="card-body">
            <form id="generator-maintenance-form" class="form-grid">
              <div class="form-group">
                <label for="generator_maintenance_generator">Groupe √âlectrog√®ne</label>
                <select id="generator_maintenance_generator" required>
                  <option value="">S√©lectionner un groupe...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_maintenance_date">Date</label>
                <input type="text" id="generator_maintenance_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="generator_maintenance_type">Type de maintenance</label>
                <select id="generator_maintenance_type" required>
                  <option value="vidange">Vidange</option>
                  <option value="filtre_air">Filtre √† air</option>
                  <option value="filtre_carburant">Filtre √† carburant</option>
                  <option value="bougie">Bougie</option>
                  <option value="batterie">Batterie</option>
                  <option value="alternateur">Alternateur</option>
                  <option value="demarreur">D√©marreur</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_maintenance_cout">Co√ªt (GNF)</label>
                <input type="number" step="0.01" id="generator_maintenance_cout" placeholder="Ex: 150000" required />
              </div>
              
              <div class="form-group full-width">
                <label for="generator_maintenance_description">Description</label>
                <textarea id="generator_maintenance_description" placeholder="D√©tails de la maintenance, pi√®ces remplac√©es..."></textarea>
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Maintenance</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Generators List -->
        <section id="generators-list" class="card">
          <div class="card-header">
            <h2><i class="fas fa-list"></i> Liste des Groupes √âlectrog√®nes</h2>
            <div class="search-box">
              <input type="text" id="search-generator" placeholder="Rechercher groupe...">
              <i class="fas fa-search"></i>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="generators-table">
                <thead>
                  <tr>
                    <th>N¬∞ Inventaire</th>
                    <th>Marque/Mod√®le</th>
                    <th>Puissance</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="liste-generators">
                  <!-- Donn√©es dynamiques -->
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info" id="generator-count">0 groupes √©lectrog√®nes</div>
              <div class="pagination">
                <button id="prev-generator-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="generator-page-info">Page 1</span>
                <button id="next-generator-page" disabled><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        </section>

        <!-- Generator History Section -->
        <section id="generator-history-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-history"></i> Historique des Actions Groupe √âlectrog√®ne</h2>
            <div class="filter-actions">
              <select id="generator-filter-type">
                <option value="all">Tous les types</option>
                <option value="generator">Groupes</option>
                <option value="fuel">Carburant</option>
                <option value="maintenance">Maintenance</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline" id="generator-historique">
              <!-- Historique dynamique -->
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Vehicle Modal -->
  <div id="vehicule-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="vehicule-modal-title">D√©tails du V√©hicule</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="vehicule-modal-body">
        <!-- Contenu dynamique -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Bike Modal -->
  <div id="bike-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="bike-modal-title">D√©tails de la Moto/Tricycle</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="bike-modal-body">
        <!-- Contenu dynamique -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Generator Modal -->
  <div id="generator-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="generator-modal-title">D√©tails du Groupe √âlectrog√®ne</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="generator-modal-body">
        <!-- Contenu dynamique -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script>
    // Data Storage
    let vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];
    let fuelRecords = JSON.parse(localStorage.getItem('fuelRecords')) || [];
    let maintenanceRecords = JSON.parse(localStorage.getItem('maintenanceRecords')) || [];
    let bikes = JSON.parse(localStorage.getItem('bikes')) || [];
    let bikeFuelRecords = JSON.parse(localStorage.getItem('bikeFuelRecords')) || [];
    let bikeMaintenanceRecords = JSON.parse(localStorage.getItem('bikeMaintenanceRecords')) || [];
    let generators = JSON.parse(localStorage.getItem('generators')) || [];
    let generatorFuelRecords = JSON.parse(localStorage.getItem('generatorFuelRecords')) || [];
    let generatorMaintenanceRecords = JSON.parse(localStorage.getItem('generatorMaintenanceRecords')) || [];
    let history = JSON.parse(localStorage.getItem('history')) || [];

    // Pagination Variables
    let currentPage = 1;
    let currentBikePage = 1;
    let currentGeneratorPage = 1;
    const itemsPerPage = 10;

    // DOM Elements
    const tabButtons = document.querySelectorAll('.nav-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const themeToggle = document.getElementById('toggle-theme');
    const exportButton = document.getElementById('export-excel');

    // Initialize App
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      setupEventListeners();
      loadVehicles();
      loadBikes();
      loadGenerators();
      loadHistory();
      updateVehicleSelects();
      updateBikeSelects();
      updateGeneratorSelects();
    }

    function setupEventListeners() {
      // Tab Navigation
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.getAttribute('data-tab');
          switchTab(tabId);
        });
      });

      // Theme Toggle
      themeToggle.addEventListener('click', toggleTheme);

      // Export Excel
      exportButton.addEventListener('click', exportToExcel);

      // Vehicle Form
      document.getElementById('vehicule-form').addEventListener('submit', handleVehicleSubmit);
      document.getElementById('clear-form').addEventListener('click', clearVehicleForm);
      document.getElementById('cancel-edit').addEventListener('click', cancelVehicleEdit);

      // Vehicle Search
      document.getElementById('search-vehicule').addEventListener('input', filterVehicles);

      // Vehicle Pagination
      document.getElementById('prev-page').addEventListener('click', () => changePage(-1));
      document.getElementById('next-page').addEventListener('click', () => changePage(1));

      // Fuel Form
      document.getElementById('carburant-form').addEventListener('submit', handleFuelSubmit);

      // Maintenance Form
      document.getElementById('vehicle-maintenance-form').addEventListener('submit', handleMaintenanceSubmit);

      // Bike Form
      document.getElementById('bike-form').addEventListener('submit', handleBikeSubmit);
      document.getElementById('clear-bike-form').addEventListener('click', clearBikeForm);
      document.getElementById('cancel-bike-edit').addEventListener('click', cancelBikeEdit);

      // Bike Search
      document.getElementById('search-bike').addEventListener('input', filterBikes);

      // Bike Pagination
      document.getElementById('prev-bike-page').addEventListener('click', () => changeBikePage(-1));
      document.getElementById('next-bike-page').addEventListener('click', () => changeBikePage(1));

      // Bike Fuel Form
      document.getElementById('bike-fuel-form').addEventListener('submit', handleBikeFuelSubmit);

      // Bike Maintenance Form
      document.getElementById('bike-maintenance-form').addEventListener('submit', handleBikeMaintenanceSubmit);

      // Generator Form
      document.getElementById('generator-form').addEventListener('submit', handleGeneratorSubmit);
      document.getElementById('clear-generator-form').addEventListener('click', clearGeneratorForm);
      document.getElementById('cancel-generator-edit').addEventListener('click', cancelGeneratorEdit);

      // Generator Search
      document.getElementById('search-generator').addEventListener('input', filterGenerators);

      // Generator Pagination
      document.getElementById('prev-generator-page').addEventListener('click', () => changeGeneratorPage(-1));
      document.getElementById('next-generator-page').addEventListener('click', () => changeGeneratorPage(1));

      // Generator Fuel Form
      document.getElementById('generator-fuel-form').addEventListener('submit', handleGeneratorFuelSubmit);

      // Generator Maintenance Form
      document.getElementById('generator-maintenance-form').addEventListener('submit', handleGeneratorMaintenanceSubmit);

      // History Filter
      document.getElementById('filter-type').addEventListener('change', loadHistory);
      document.getElementById('bike-filter-type').addEventListener('change', loadBikeHistory);
      document.getElementById('generator-filter-type').addEventListener('change', loadGeneratorHistory);

      // Modal Close
      document.querySelectorAll('.close-modal').forEach(button => {
        button.addEventListener('click', () => {
          document.querySelectorAll('.modal').forEach(modal => {
            modal.classList.remove('show');
          });
        });
      });

      // Auto-calculations for vehicle form
      document.getElementById('km_avant').addEventListener('input', calculateKmParcouru);
      document.getElementById('km_apres').addEventListener('input', calculateKmParcouru);

      // Auto-calculations for fuel form
      document.getElementById('carburant_km_depart').addEventListener('input', calculateFuelKmParcouru);
      document.getElementById('carburant_km_arrivee').addEventListener('input', calculateFuelKmParcouru);
      document.getElementById('carburant_litres').addEventListener('input', calculateFuelCost);
      document.getElementById('carburant_prix_unitaire').addEventListener('input', calculateFuelCost);

      // Auto-calculations for bike fuel form
      document.getElementById('bike_fuel_litres').addEventListener('input', calculateBikeFuelCost);
      document.getElementById('bike_fuel_prix_unitaire').addEventListener('input', calculateBikeFuelCost);

      // Auto-calculations for generator fuel form
      document.getElementById('generator_fuel_litres').addEventListener('input', calculateGeneratorFuelCost);
      document.getElementById('generator_fuel_prix_unitaire').addEventListener('input', calculateGeneratorFuelCost);
    }

    // Tab Management
    function switchTab(tabId) {
      // Update active tab button
      tabButtons.forEach(button => {
        if (button.getAttribute('data-tab') === tabId) {
          button.classList.add('active');
        } else {
          button.classList.remove('active');
        }
      });

      // Update active tab content
      tabContents.forEach(content => {
        if (content.id === `${tabId}-tab`) {
          content.classList.add('active');
        } else {
          content.classList.remove('active');
        }
      });

      // Reset pagination when switching tabs
      currentPage = 1;
      currentBikePage = 1;
      currentGeneratorPage = 1;
    }

    // Theme Management
    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.body.setAttribute('data-theme', newTheme);
      themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      
      localStorage.setItem('theme', newTheme);
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.body.setAttribute('data-theme', savedTheme);
      themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    // Vehicle Management
    function handleVehicleSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: document.getElementById('vehicule-form').dataset.editingId || Date.now().toString(),
        immatriculation: document.getElementById('immatriculation').value,
        marque: document.getElementById('marque').value,
        type: document.getElementById('type').value,
        date_circulation: document.getElementById('date_circulation').value,
        statut: document.getElementById('statut').value,
        chauffeur: document.getElementById('chauffeur').value,
        observations: document.getElementById('observations').value,
        departement: document.getElementById('departement').value,
        destination: document.getElementById('destination').value,
        motif_deplacement: document.getElementById('motif_deplacement').value,
        km_avant: document.getElementById('km_avant').value,
        km_apres: document.getElementById('km_apres').value,
        km_parcouru: document.getElementById('km_parcouru').value
      };

      const isEditing = document.getElementById('vehicule-form').dataset.editingId;
      
      if (isEditing) {
        // Update existing vehicle
        const index = vehicles.findIndex(v => v.id === isEditing);
        if (index !== -1) {
          vehicles[index] = formData;
          addToHistory('vehicle', `V√©hicule ${formData.immatriculation} modifi√©`);
        }
      } else {
        // Add new vehicle
        vehicles.push(formData);
        addToHistory('vehicle', `Nouveau v√©hicule ${formData.immatriculation} ajout√©`);
      }

      saveData();
      loadVehicles();
      updateVehicleSelects();
      clearVehicleForm();
      showToast(isEditing ? 'V√©hicule modifi√© avec succ√®s' : 'V√©hicule ajout√© avec succ√®s');
    }

    function clearVehicleForm() {
      document.getElementById('vehicule-form').reset();
      delete document.getElementById('vehicule-form').dataset.editingId;
      document.getElementById('cancel-edit').style.display = 'none';
    }

    function cancelVehicleEdit() {
      clearVehicleForm();
    }

    function editVehicle(id) {
      const vehicle = vehicles.find(v => v.id === id);
      if (!vehicle) return;

      document.getElementById('immatriculation').value = vehicle.immatriculation;
      document.getElementById('marque').value = vehicle.marque;
      document.getElementById('type').value = vehicle.type;
      document.getElementById('date_circulation').value = vehicle.date_circulation;
      document.getElementById('statut').value = vehicle.statut;
      document.getElementById('chauffeur').value = vehicle.chauffeur || '';
      document.getElementById('observations').value = vehicle.observations || '';
      document.getElementById('departement').value = vehicle.departement || '';
      document.getElementById('destination').value = vehicle.destination || '';
      document.getElementById('motif_deplacement').value = vehicle.motif_deplacement || '';
      document.getElementById('km_avant').value = vehicle.km_avant || '';
      document.getElementById('km_apres').value = vehicle.km_apres || '';
      document.getElementById('km_parcouru').value = vehicle.km_parcouru || '';

      document.getElementById('vehicule-form').dataset.editingId = id;
      document.getElementById('cancel-edit').style.display = 'inline-flex';
    }

    function deleteVehicle(id) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer ce v√©hicule ?')) {
        const vehicle = vehicles.find(v => v.id === id);
        vehicles = vehicles.filter(v => v.id !== id);
        
        // Also remove related fuel and maintenance records
        fuelRecords = fuelRecords.filter(f => f.vehicule_id !== id);
        maintenanceRecords = maintenanceRecords.filter(m => m.vehicule_id !== id);
        
        saveData();
        loadVehicles();
        updateVehicleSelects();
        addToHistory('vehicle', `V√©hicule ${vehicle.immatriculation} supprim√©`);
        showToast('V√©hicule supprim√© avec succ√®s');
      }
    }

    function loadVehicles() {
      const searchTerm = document.getElementById('search-vehicule').value.toLowerCase();
      const filteredVehicles = vehicles.filter(vehicle => 
        vehicle.immatriculation.toLowerCase().includes(searchTerm) ||
        vehicle.marque.toLowerCase().includes(searchTerm) ||
        (vehicle.chauffeur && vehicle.chauffeur.toLowerCase().includes(searchTerm))
      );

      const startIndex = (currentPage - 1) * itemsPerPage;
      const paginatedVehicles = filteredVehicles.slice(startIndex, startIndex + itemsPerPage);

      const tbody = document.getElementById('liste-vehicules');
      tbody.innerHTML = '';

      paginatedVehicles.forEach(vehicle => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${vehicle.immatriculation}</td>
          <td>${vehicle.marque}</td>
          <td>${formatVehicleType(vehicle.type)}</td>
          <td><span class="bike-status ${vehicle.statut.replace(' ', '-')}">${formatStatus(vehicle.statut)}</span></td>
          <td>
            <button class="btn btn-sm btn-outline" onclick="viewVehicle('${vehicle.id}')"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline" onclick="editVehicle('${vehicle.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline" onclick="deleteVehicle('${vehicle.id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update pagination info
      document.getElementById('vehicule-count').textContent = `${filteredVehicles.length} v√©hicule(s)`;
      document.getElementById('page-info').textContent = `Page ${currentPage}`;
      document.getElementById('prev-page').disabled = currentPage === 1;
      document.getElementById('next-page').disabled = startIndex + itemsPerPage >= filteredVehicles.length;
    }

    function filterVehicles() {
      currentPage = 1;
      loadVehicles();
    }

    function changePage(direction) {
      currentPage += direction;
      loadVehicles();
    }

    // Bike Management
    function handleBikeSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: document.getElementById('bike-form').dataset.editingId || Date.now().toString(),
        immatriculation: document.getElementById('bike_immatriculation').value,
        marque: document.getElementById('bike_marque').value,
        type: document.getElementById('bike_type').value,
        date_circulation: document.getElementById('bike_date_circulation').value,
        statut: document.getElementById('bike_statut').value,
        chauffeur: document.getElementById('bike_chauffeur').value,
        observations: document.getElementById('bike_observations').value
      };

      const isEditing = document.getElementById('bike-form').dataset.editingId;
      
      if (isEditing) {
        // Update existing bike
        const index = bikes.findIndex(b => b.id === isEditing);
        if (index !== -1) {
          bikes[index] = formData;
          addToHistory('bike', `Moto/Tricycle ${formData.immatriculation} modifi√©`);
        }
      } else {
        // Add new bike
        bikes.push(formData);
        addToHistory('bike', `Nouvelle moto/tricycle ${formData.immatriculation} ajout√©`);
      }

      saveData();
      loadBikes();
      updateBikeSelects();
      clearBikeForm();
      showToast(isEditing ? 'Moto/Tricycle modifi√© avec succ√®s' : 'Moto/Tricycle ajout√© avec succ√®s');
    }

    function clearBikeForm() {
      document.getElementById('bike-form').reset();
      delete document.getElementById('bike-form').dataset.editingId;
      document.getElementById('cancel-bike-edit').style.display = 'none';
    }

    function cancelBikeEdit() {
      clearBikeForm();
    }

    function editBike(id) {
      const bike = bikes.find(b => b.id === id);
      if (!bike) return;

      document.getElementById('bike_immatriculation').value = bike.immatriculation;
      document.getElementById('bike_marque').value = bike.marque;
      document.getElementById('bike_type').value = bike.type;
      document.getElementById('bike_date_circulation').value = bike.date_circulation;
      document.getElementById('bike_statut').value = bike.statut;
      document.getElementById('bike_chauffeur').value = bike.chauffeur || '';
      document.getElementById('bike_observations').value = bike.observations || '';

      document.getElementById('bike-form').dataset.editingId = id;
      document.getElementById('cancel-bike-edit').style.display = 'inline-flex';
    }

    function deleteBike(id) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cette moto/tricycle ?')) {
        const bike = bikes.find(b => b.id === id);
        bikes = bikes.filter(b => b.id !== id);
        
        // Also remove related fuel and maintenance records
        bikeFuelRecords = bikeFuelRecords.filter(f => f.bike_id !== id);
        bikeMaintenanceRecords = bikeMaintenanceRecords.filter(m => m.bike_id !== id);
        
        saveData();
        loadBikes();
        updateBikeSelects();
        addToHistory('bike', `Moto/Tricycle ${bike.immatriculation} supprim√©`);
        showToast('Moto/Tricycle supprim√© avec succ√®s');
      }
    }

    function loadBikes() {
      const searchTerm = document.getElementById('search-bike').value.toLowerCase();
      const filteredBikes = bikes.filter(bike => 
        bike.immatriculation.toLowerCase().includes(searchTerm) ||
        bike.marque.toLowerCase().includes(searchTerm) ||
        (bike.chauffeur && bike.chauffeur.toLowerCase().includes(searchTerm))
      );

      const startIndex = (currentBikePage - 1) * itemsPerPage;
      const paginatedBikes = filteredBikes.slice(startIndex, startIndex + itemsPerPage);

      const tbody = document.getElementById('liste-bikes');
      tbody.innerHTML = '';

      paginatedBikes.forEach(bike => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${bike.immatriculation}</td>
          <td>${bike.marque}</td>
          <td>${formatBikeType(bike.type)}</td>
          <td><span class="bike-status ${bike.statut.replace(' ', '-')}">${formatStatus(bike.statut)}</span></td>
          <td>
            <button class="btn btn-sm btn-outline" onclick="viewBike('${bike.id}')"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline" onclick="editBike('${bike.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline" onclick="deleteBike('${bike.id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update pagination info
      document.getElementById('bike-count').textContent = `${filteredBikes.length} moto(s)/tricycle(s)`;
      document.getElementById('bike-page-info').textContent = `Page ${currentBikePage}`;
      document.getElementById('prev-bike-page').disabled = currentBikePage === 1;
      document.getElementById('next-bike-page').disabled = startIndex + itemsPerPage >= filteredBikes.length;
    }

    function filterBikes() {
      currentBikePage = 1;
      loadBikes();
    }

    function changeBikePage(direction) {
      currentBikePage += direction;
      loadBikes();
    }

    // Generator Management
    function handleGeneratorSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: document.getElementById('generator-form').dataset.editingId || Date.now().toString(),
        numero: document.getElementById('generator_numero').value,
        marque: document.getElementById('generator_marque').value,
        puissance: document.getElementById('generator_puissance').value,
        date_acquisition: document.getElementById('generator_date_acquisition').value,
        statut: document.getElementById('generator_statut').value,
        localisation: document.getElementById('generator_localisation').value,
        observations: document.getElementById('generator_observations').value
      };

      const isEditing = document.getElementById('generator-form').dataset.editingId;
      
      if (isEditing) {
        // Update existing generator
        const index = generators.findIndex(g => g.id === isEditing);
        if (index !== -1) {
          generators[index] = formData;
          addToHistory('generator', `Groupe √©lectrog√®ne ${formData.numero} modifi√©`);
        }
      } else {
        // Add new generator
        generators.push(formData);
        addToHistory('generator', `Nouveau groupe √©lectrog√®ne ${formData.numero} ajout√©`);
      }

      saveData();
      loadGenerators();
      updateGeneratorSelects();
      clearGeneratorForm();
      showToast(isEditing ? 'Groupe √©lectrog√®ne modifi√© avec succ√®s' : 'Groupe √©lectrog√®ne ajout√© avec succ√®s');
    }

    function clearGeneratorForm() {
      document.getElementById('generator-form').reset();
      delete document.getElementById('generator-form').dataset.editingId;
      document.getElementById('cancel-generator-edit').style.display = 'none';
    }

    function cancelGeneratorEdit() {
      clearGeneratorForm();
    }

    function editGenerator(id) {
      const generator = generators.find(g => g.id === id);
      if (!generator) return;

      document.getElementById('generator_numero').value = generator.numero;
      document.getElementById('generator_marque').value = generator.marque;
      document.getElementById('generator_puissance').value = generator.puissance;
      document.getElementById('generator_date_acquisition').value = generator.date_acquisition;
      document.getElementById('generator_statut').value = generator.statut;
      document.getElementById('generator_localisation').value = generator.localisation || '';
      document.getElementById('generator_observations').value = generator.observations || '';

      document.getElementById('generator-form').dataset.editingId = id;
      document.getElementById('cancel-generator-edit').style.display = 'inline-flex';
    }

    function deleteGenerator(id) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer ce groupe √©lectrog√®ne ?')) {
        const generator = generators.find(g => g.id === id);
        generators = generators.filter(g => g.id !== id);
        
        // Also remove related fuel and maintenance records
        generatorFuelRecords = generatorFuelRecords.filter(f => f.generator_id !== id);
        generatorMaintenanceRecords = generatorMaintenanceRecords.filter(m => m.generator_id !== id);
        
        saveData();
        loadGenerators();
        updateGeneratorSelects();
        addToHistory('generator', `Groupe √©lectrog√®ne ${generator.numero} supprim√©`);
        showToast('Groupe √©lectrog√®ne supprim√© avec succ√®s');
      }
    }

    function loadGenerators() {
      const searchTerm = document.getElementById('search-generator').value.toLowerCase();
      const filteredGenerators = generators.filter(generator => 
        generator.numero.toLowerCase().includes(searchTerm) ||
        generator.marque.toLowerCase().includes(searchTerm) ||
        (generator.localisation && generator.localisation.toLowerCase().includes(searchTerm))
      );

      const startIndex = (currentGeneratorPage - 1) * itemsPerPage;
      const paginatedGenerators = filteredGenerators.slice(startIndex, startIndex + itemsPerPage);

      const tbody = document.getElementById('liste-generators');
      tbody.innerHTML = '';

      paginatedGenerators.forEach(generator => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${generator.numero}</td>
          <td>${generator.marque}</td>
          <td>${generator.puissance} kVA</td>
          <td><span class="bike-status ${generator.statut.replace(' ', '-')}">${formatGeneratorStatus(generator.statut)}</span></td>
          <td>
            <button class="btn btn-sm btn-outline" onclick="viewGenerator('${generator.id}')"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline" onclick="editGenerator('${generator.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline" onclick="deleteGenerator('${generator.id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update pagination info
      document.getElementById('generator-count').textContent = `${filteredGenerators.length} groupe(s) √©lectrog√®ne(s)`;
      document.getElementById('generator-page-info').textContent = `Page ${currentGeneratorPage}`;
      document.getElementById('prev-generator-page').disabled = currentGeneratorPage === 1;
      document.getElementById('next-generator-page').disabled = startIndex + itemsPerPage >= filteredGenerators.length;
    }

    function filterGenerators() {
      currentGeneratorPage = 1;
      loadGenerators();
    }

    function changeGeneratorPage(direction) {
      currentGeneratorPage += direction;
      loadGenerators();
    }

    // Fuel Management
    function handleFuelSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: Date.now().toString(),
        vehicule_id: document.getElementById('carburant_vehicule').value,
        date: document.getElementById('carburant_date').value,
        km_depart: document.getElementById('carburant_km_depart').value,
        km_arrivee: document.getElementById('carburant_km_arrivee').value,
        km_parcouru: document.getElementById('carburant_km_parcouru').value,
        litres: document.getElementById('carburant_litres').value,
        consommation_100km: document.getElementById('carburant_consommation_100km').value,
        prix_unitaire: document.getElementById('carburant_prix_unitaire').value,
        type: document.getElementById('carburant_type').value,
        cout: document.getElementById('carburant_cout').value
      };

      fuelRecords.push(formData);
      
      const vehicle = vehicles.find(v => v.id === formData.vehicule_id);
      addToHistory('fuel', `Ravitaillement pour ${vehicle.immatriculation}: ${formData.litres}L`);
      
      saveData();
      document.getElementById('carburant-form').reset();
      showToast('Ravitaillement enregistr√© avec succ√®s');
    }

    function handleBikeFuelSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: Date.now().toString(),
        bike_id: document.getElementById('bike_fuel_bike').value,
        date: document.getElementById('bike_fuel_date').value,
        litres: document.getElementById('bike_fuel_litres').value,
        prix_unitaire: document.getElementById('bike_fuel_prix_unitaire').value,
        type: document.getElementById('bike_fuel_type').value,
        cout: document.getElementById('bike_fuel_cout').value
      };

      bikeFuelRecords.push(formData);
      
      const bike = bikes.find(b => b.id === formData.bike_id);
      addToHistory('fuel', `Ravitaillement pour ${bike.immatriculation}: ${formData.litres}L`);
      
      saveData();
      document.getElementById('bike-fuel-form').reset();
      showToast('Ravitaillement moto/tricycle enregistr√© avec succ√®s');
    }

    function handleGeneratorFuelSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: Date.now().toString(),
        generator_id: document.getElementById('generator_fuel_generator').value,
        date: document.getElementById('generator_fuel_date').value,
        litres: document.getElementById('generator_fuel_litres').value,
        prix_unitaire: document.getElementById('generator_fuel_prix_unitaire').value,
        type: document.getElementById('generator_fuel_type').value,
        cout: document.getElementById('generator_fuel_cout').value
      };

      generatorFuelRecords.push(formData);
      
      const generator = generators.find(g => g.id === formData.generator_id);
      addToHistory('fuel', `Ravitaillement pour ${generator.numero}: ${formData.litres}L`);
      
      saveData();
      document.getElementById('generator-fuel-form').reset();
      showToast('Ravitaillement groupe √©lectrog√®ne enregistr√© avec succ√®s');
    }

    // Maintenance Management
    function handleMaintenanceSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: Date.now().toString(),
        vehicule_id: document.getElementById('vehicle_maintenance_vehicule').value,
        date: document.getElementById('vehicle_maintenance_date').value,
        type: document.getElementById('vehicle_maintenance_type').value,
        cout: document.getElementById('vehicle_maintenance_cout').value,
        description: document.getElementById('vehicle_maintenance_description').value
      };

      maintenanceRecords.push(formData);
      
      const vehicle = vehicles.find(v => v.id === formData.vehicule_id);
      addToHistory('maintenance', `Maintenance pour ${vehicle.immatriculation}: ${formatMaintenanceType(formData.type)}`);
      
      saveData();
      document.getElementById('vehicle-maintenance-form').reset();
      showToast('Maintenance enregistr√©e avec succ√®s');
    }

    function handleBikeMaintenanceSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: Date.now().toString(),
        bike_id: document.getElementById('bike_maintenance_bike').value,
        date: document.getElementById('bike_maintenance_date').value,
        type: document.getElementById('bike_maintenance_type').value,
        cout: document.getElementById('bike_maintenance_cout').value,
        description: document.getElementById('bike_maintenance_description').value
      };

      bikeMaintenanceRecords.push(formData);
      
      const bike = bikes.find(b => b.id === formData.bike_id);
      addToHistory('maintenance', `Maintenance pour ${bike.immatriculation}: ${formatBikeMaintenanceType(formData.type)}`);
      
      saveData();
      document.getElementById('bike-maintenance-form').reset();
      showToast('Maintenance moto/tricycle enregistr√©e avec succ√®s');
    }

    function handleGeneratorMaintenanceSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: Date.now().toString(),
        generator_id: document.getElementById('generator_maintenance_generator').value,
        date: document.getElementById('generator_maintenance_date').value,
        type: document.getElementById('generator_maintenance_type').value,
        cout: document.getElementById('generator_maintenance_cout').value,
        description: document.getElementById('generator_maintenance_description').value
      };

      generatorMaintenanceRecords.push(formData);
      
      const generator = generators.find(g => g.id === formData.generator_id);
      addToHistory('maintenance', `Maintenance pour ${generator.numero}: ${formatGeneratorMaintenanceType(formData.type)}`);
      
      saveData();
      document.getElementById('generator-maintenance-form').reset();
      showToast('Maintenance groupe √©lectrog√®ne enregistr√©e avec succ√®s');
    }

    // History Management
    function addToHistory(type, action) {
      const historyItem = {
        id: Date.now().toString(),
        type: type,
        action: action,
        timestamp: new Date().toISOString()
      };
      
      history.unshift(historyItem);
      
      // Keep only last 100 history items
      if (history.length > 100) {
        history = history.slice(0, 100);
      }
      
      saveData();
      loadHistory();
      loadBikeHistory();
      loadGeneratorHistory();
    }

    function loadHistory() {
      const filterType = document.getElementById('filter-type').value;
      let filteredHistory = history;
      
      if (filterType !== 'all') {
        filteredHistory = history.filter(item => item.type === filterType);
      }
      
      const timeline = document.getElementById('historique');
      timeline.innerHTML = '';
      
      filteredHistory.slice(0, 20).forEach(item => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `
          <div class="timeline-date">${formatDateTime(item.timestamp)}</div>
          <div class="timeline-content">${item.action}</div>
        `;
        timeline.appendChild(timelineItem);
      });
    }

    function loadBikeHistory() {
      const filterType = document.getElementById('bike-filter-type').value;
      let filteredHistory = history.filter(item => 
        item.type === 'bike' || item.type === 'fuel' || item.type === 'maintenance'
      );
      
      if (filterType !== 'all') {
        filteredHistory = history.filter(item => item.type === filterType);
      }
      
      const timeline = document.getElementById('bike-historique');
      timeline.innerHTML = '';
      
      filteredHistory.slice(0, 20).forEach(item => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `
          <div class="timeline-date">${formatDateTime(item.timestamp)}</div>
          <div class="timeline-content">${item.action}</div>
        `;
        timeline.appendChild(timelineItem);
      });
    }

    function loadGeneratorHistory() {
      const filterType = document.getElementById('generator-filter-type').value;
      let filteredHistory = history.filter(item => 
        item.type === 'generator' || item.type === 'fuel' || item.type === 'maintenance'
      );
      
      if (filterType !== 'all') {
        filteredHistory = history.filter(item => item.type === filterType);
      }
      
      const timeline = document.getElementById('generator-historique');
      timeline.innerHTML = '';
      
      filteredHistory.slice(0, 20).forEach(item => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `
          <div class="timeline-date">${formatDateTime(item.timestamp)}</div>
          <div class="timeline-content">${item.action}</div>
        `;
        timeline.appendChild(timelineItem);
      });
    }

    // View Details Functions
    function viewVehicle(id) {
      const vehicle = vehicles.find(v => v.id === id);
      if (!vehicle) return;
      
      const fuelRecordsForVehicle = fuelRecords.filter(f => f.vehicule_id === id);
      const maintenanceRecordsForVehicle = maintenanceRecords.filter(m => m.vehicule_id === id);
      
      document.getElementById('vehicule-modal-title').textContent = `D√©tails: ${vehicle.immatriculation}`;
      
      const formattedDate = formatToFrenchDate(vehicle.date_circulation);
      
      let html = `
        <div class="bike-details-grid">
          <div class="detail-item">
            <span class="detail-label">Marque/Mod√®le:</span>
            <span class="detail-value">${vehicle.marque}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Type:</span>
            <span class="detail-value">${formatVehicleType(vehicle.type)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Mise en circulation:</span>
            <span class="detail-value">${formattedDate}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut:</span>
            <span class="detail-value">${formatStatus(vehicle.statut)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Chauffeur assign√©:</span>
            <span class="detail-value">${vehicle.chauffeur || 'Non assign√©'}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">D√©partement:</span>
            <span class="detail-value">${vehicle.departement || 'Non sp√©cifi√©'}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">Observations:</span>
            <span class="detail-value">${vehicle.observations || 'Aucune'}</span>
          </div>
        </div>
      `;
      
      if (fuelRecordsForVehicle.length > 0) {
        html += `<h4 class="maintenance-title">Historique des ravitaillements</h4>`;
        fuelRecordsForVehicle.slice(0, 5).forEach(record => {
          const recordDate = formatToFrenchDate(record.date);
          html += `
            <div class="maintenance-item">
              <div class="maintenance-header">
                <span class="maintenance-type">${formatFuelType(record.type)}</span>
                <span class="maintenance-date">${recordDate}</span>
              </div>
              <div class="maintenance-cost">${record.litres}L - ${formatCurrency(record.cout)}</div>
              <div class="maintenance-description">Kilom√©trage: ${record.km_depart} ‚Üí ${record.km_arrivee} (${record.km_parcouru} km parcourus)</div>
              ${record.consommation_100km ? `<div class="maintenance-description">Consommation: ${record.consommation_100km}L/100km</div>` : ''}
            </div>
          `;
        });
      }
      
      if (maintenanceRecordsForVehicle.length > 0) {
        html += `<h4 class="maintenance-title">Historique des maintenances</h4>`;
        maintenanceRecordsForVehicle.slice(0, 5).forEach(record => {
          const recordDate = formatToFrenchDate(record.date);
          html += `
            <div class="maintenance-item">
              <div class="maintenance-header">
                <span class="maintenance-type">${formatMaintenanceType(record.type)}</span>
                <span class="maintenance-date">${recordDate}</span>
              </div>
              <div class="maintenance-cost">Co√ªt: ${formatCurrency(record.cout)}</div>
              <div class="maintenance-description">${record.description || 'Aucune description'}</div>
            </div>
          `;
        });
      }
      
      document.getElementById('vehicule-modal-body').innerHTML = html;
      document.getElementById('vehicule-modal').classList.add('show');
    }

    function viewBike(id) {
      const bike = bikes.find(b => b.id === id);
      if (!bike) return;
      
      const fuelRecordsForBike = bikeFuelRecords.filter(f => f.bike_id === id);
      const maintenanceRecordsForBike = bikeMaintenanceRecords.filter(m => m.bike_id === id);
      
      document.getElementById('bike-modal-title').textContent = `D√©tails: ${bike.immatriculation}`;
      
      const formattedDate = formatToFrenchDate(bike.date_circulation);
      
      let html = `
        <div class="bike-details-grid">
          <div class="detail-item">
            <span class="detail-label">Marque/Mod√®le:</span>
            <span class="detail-value">${bike.marque}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Type:</span>
            <span class="detail-value">${formatBikeType(bike.type)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Mise en circulation:</span>
            <span class="detail-value">${formattedDate}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut:</span>
            <span class="detail-value">${formatStatus(bike.statut)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Livreur assign√©:</span>
            <span class="detail-value">${bike.chauffeur || 'Non assign√©'}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">Observations:</span>
            <span class="detail-value">${bike.observations || 'Aucune'}</span>
          </div>
        </div>
      `;
      
      if (fuelRecordsForBike.length > 0) {
        html += `<h4 class="maintenance-title">Historique des ravitaillements</h4>`;
        fuelRecordsForBike.slice(0, 5).forEach(record => {
          const recordDate = formatToFrenchDate(record.date);
          html += `
            <div class="maintenance-item">
              <div class="maintenance-header">
                <span class="maintenance-type">${formatFuelType(record.type)}</span>
                <span class="maintenance-date">${recordDate}</span>
              </div>
              <div class="maintenance-cost">${record.litres}L - ${formatCurrency(record.cout)}</div>
            </div>
          `;
        });
      }
      
      if (maintenanceRecordsForBike.length > 0) {
        html += `<h4 class="maintenance-title">Historique des maintenances</h4>`;
        maintenanceRecordsForBike.slice(0, 5).forEach(record => {
          const recordDate = formatToFrenchDate(record.date);
          html += `
            <div class="maintenance-item">
              <div class="maintenance-header">
                <span class="maintenance-type">${formatBikeMaintenanceType(record.type)}</span>
                <span class="maintenance-date">${recordDate}</span>
              </div>
              <div class="maintenance-cost">Co√ªt: ${formatCurrency(record.cout)}</div>
              <div class="maintenance-description">${record.description || 'Aucune description'}</div>
            </div>
          `;
        });
      }
      
      document.getElementById('bike-modal-body').innerHTML = html;
      document.getElementById('bike-modal').classList.add('show');
    }

    function viewGenerator(id) {
      const generator = generators.find(g => g.id === id);
      if (!generator) return;
      
      const fuelRecordsForGenerator = generatorFuelRecords.filter(f => f.generator_id === id);
      const maintenanceRecordsForGenerator = generatorMaintenanceRecords.filter(m => m.generator_id === id);
      
      document.getElementById('generator-modal-title').textContent = `D√©tails: ${generator.numero}`;
      
      const formattedDate = formatToFrenchDate(generator.date_acquisition);
      
      let html = `
        <div class="bike-details-grid">
          <div class="detail-item">
            <span class="detail-label">Marque/Mod√®le:</span>
            <span class="detail-value">${generator.marque}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Puissance:</span>
            <span class="detail-value">${generator.puissance} kVA</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Date d'acquisition:</span>
            <span class="detail-value">${formattedDate}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut:</span>
            <span class="detail-value">${formatGeneratorStatus(generator.statut)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Localisation:</span>
            <span class="detail-value">${generator.localisation || 'Non sp√©cifi√©e'}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">Observations:</span>
            <span class="detail-value">${generator.observations || 'Aucune'}</span>
          </div>
        </div>
      `;
      
      if (fuelRecordsForGenerator.length > 0) {
        html += `<h4 class="maintenance-title">Historique des ravitaillements</h4>`;
        fuelRecordsForGenerator.slice(0, 5).forEach(record => {
          const recordDate = formatToFrenchDate(record.date);
          html += `
            <div class="maintenance-item">
              <div class="maintenance-header">
                <span class="maintenance-type">${formatFuelType(record.type)}</span>
                <span class="maintenance-date">${recordDate}</span>
              </div>
              <div class="maintenance-cost">${record.litres}L - ${formatCurrency(record.cout)}</div>
            </div>
          `;
        });
      }
      
      if (maintenanceRecordsForGenerator.length > 0) {
        html += `<h4 class="maintenance-title">Historique des maintenances</h4>`;
        maintenanceRecordsForGenerator.slice(0, 5).forEach(record => {
          const recordDate = formatToFrenchDate(record.date);
          html += `
            <div class="maintenance-item">
              <div class="maintenance-header">
                <span class="maintenance-type">${formatGeneratorMaintenanceType(record.type)}</span>
                <span class="maintenance-date">${recordDate}</span>
              </div>
              <div class="maintenance-cost">Co√ªt: ${formatCurrency(record.cout)}</div>
              <div class="maintenance-description">${record.description || 'Aucune description'}</div>
            </div>
          `;
        });
      }
      
      document.getElementById('generator-modal-body').innerHTML = html;
      document.getElementById('generator-modal').classList.add('show');
    }

    // Helper Functions
    function formatVehicleType(type) {
      const types = {
        'voiture': 'Voiture',
        'camion': 'Camion',
        'bus': 'Bus',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatBikeType(type) {
      const types = {
        'moto_cross': 'Moto Cross',
        'moto_routiere': 'Moto Routi√®re',
        'scooter': 'Scooter',
        'tricycle': 'Tricycle',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatStatus(status) {
      const statuses = {
        'en service': 'En service',
        'en panne': 'En panne',
        'en maintenance': 'En maintenance',
        'hors service': 'Hors service'
      };
      return statuses[status] || status;
    }

    function formatGeneratorStatus(status) {
      const statuses = {
        'fonctionnel': 'Fonctionnel',
        'en_panne': 'En panne',
        'en_maintenance': 'En maintenance',
        'hors_service': 'Hors service'
      };
      return statuses[status] || status;
    }

    function formatFuelType(type) {
      const types = {
        'gasoil': 'Gasoil',
        'essence': 'Essence',
        'gnc': 'GNC',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatMaintenanceType(type) {
      const types = {
        'entretien_kilometrique': 'Entretien kilom√©trique',
        'freins': 'Freins',
        'pneus': 'Pneus',
        'climatisation': 'Climatisation',
        'electrique': 'Probl√®me √©lectrique',
        'moteur': 'Probl√®me de moteur',
        'carrosserie': 'Probl√®me de carrosserie',
        'suspension': 'Probl√®me de suspension',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatBikeMaintenanceType(type) {
      const types = {
        'vidange': 'Vidange',
        'freins': 'Freins',
        'pneus': 'Pneus',
        'chaine': 'Cha√Æne',
        'bougie': 'Bougie',
        'filtre_air': 'Filtre √† air',
        'electrique': 'Probl√®me √©lectrique',
        'moteur': 'Probl√®me de moteur',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatGeneratorMaintenanceType(type) {
      const types = {
        'vidange': 'Vidange',
        'filtre_air': 'Filtre √† air',
        'filtre_carburant': 'Filtre √† carburant',
        'bougie': 'Bougie',
        'batterie': 'Batterie',
        'alternateur': 'Alternateur',
        'demarreur': 'D√©marreur',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatToFrenchDate(dateString) {
      if (!dateString) return 'Non sp√©cifi√©e';
      
      // Handle both "JJ MM AAAA" format and ISO format
      let day, month, year;
      
      if (dateString.includes(' ')) {
        // Format "JJ MM AAAA"
        const parts = dateString.split(' ');
        if (parts.length === 3) {
          day = parts[0];
          month = parts[1];
          year = parts[2];
        } else {
          return dateString; // Return as is if format is unexpected
        }
      } else {
        // ISO format or other
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
          return dateString; // Return as is if not a valid date
        }
        day = date.getDate().toString().padStart(2, '0');
        month = (date.getMonth() + 1).toString().padStart(2, '0');
        year = date.getFullYear();
      }
      
      const monthNames = [
        'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
        'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
      ];
      
      const monthIndex = parseInt(month) - 1;
      if (monthIndex >= 0 && monthIndex < 12) {
        return `${parseInt(day)} ${monthNames[monthIndex]} ${year}`;
      } else {
        return `${day}/${month}/${year}`;
      }
    }

    function formatDateTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('fr-FR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('fr-FR', {
        style: 'currency',
        currency: 'GNF'
      }).format(amount);
    }

    function updateVehicleSelects() {
      const fuelSelect = document.getElementById('carburant_vehicule');
      const maintenanceSelect = document.getElementById('vehicle_maintenance_vehicule');
      
      fuelSelect.innerHTML = '<option value="">S√©lectionner un v√©hicule...</option>';
      maintenanceSelect.innerHTML = '<option value="">S√©lectionner un v√©hicule...</option>';
      
      vehicles.forEach(vehicle => {
        const option = `<option value="${vehicle.id}">${vehicle.immatriculation} - ${vehicle.marque}</option>`;
        fuelSelect.innerHTML += option;
        maintenanceSelect.innerHTML += option;
      });
    }

    function updateBikeSelects() {
      const fuelSelect = document.getElementById('bike_fuel_bike');
      const maintenanceSelect = document.getElementById('bike_maintenance_bike');
      
      fuelSelect.innerHTML = '<option value="">S√©lectionner une moto/tricycle...</option>';
      maintenanceSelect.innerHTML = '<option value="">S√©lectionner une moto/tricycle...</option>';
      
      bikes.forEach(bike => {
        const option = `<option value="${bike.id}">${bike.immatriculation} - ${bike.marque}</option>`;
        fuelSelect.innerHTML += option;
        maintenanceSelect.innerHTML += option;
      });
    }

    function updateGeneratorSelects() {
      const fuelSelect = document.getElementById('generator_fuel_generator');
      const maintenanceSelect = document.getElementById('generator_maintenance_generator');
      
      fuelSelect.innerHTML = '<option value="">S√©lectionner un groupe...</option>';
      maintenanceSelect.innerHTML = '<option value="">S√©lectionner un groupe...</option>';
      
      generators.forEach(generator => {
        const option = `<option value="${generator.id}">${generator.numero} - ${generator.marque}</option>`;
        fuelSelect.innerHTML += option;
        maintenanceSelect.innerHTML += option;
      });
    }

    // Auto-calculation functions
    function calculateKmParcouru() {
      const kmAvant = parseFloat(document.getElementById('km_avant').value) || 0;
      const kmApres = parseFloat(document.getElementById('km_apres').value) || 0;
      
      if (kmApres >= kmAvant) {
        document.getElementById('km_parcouru').value = kmApres - kmAvant;
      } else {
        document.getElementById('km_parcouru').value = '';
      }
    }

    function calculateFuelKmParcouru() {
      const kmDepart = parseFloat(document.getElementById('carburant_km_depart').value) || 0;
      const kmArrivee = parseFloat(document.getElementById('carburant_km_arrivee').value) || 0;
      
      if (kmArrivee >= kmDepart) {
        document.getElementById('carburant_km_parcouru').value = kmArrivee - kmDepart;
      } else {
        document.getElementById('carburant_km_parcouru').value = '';
      }
    }

    function calculateFuelCost() {
      const litres = parseFloat(document.getElementById('carburant_litres').value) || 0;
      const prixUnitaire = parseFloat(document.getElementById('carburant_prix_unitaire').value) || 0;
      
      document.getElementById('carburant_cout').value = (litres * prixUnitaire).toFixed(2);
    }

    function calculateBikeFuelCost() {
      const litres = parseFloat(document.getElementById('bike_fuel_litres').value) || 0;
      const prixUnitaire = parseFloat(document.getElementById('bike_fuel_prix_unitaire').value) || 0;
      
      document.getElementById('bike_fuel_cout').value = (litres * prixUnitaire).toFixed(2);
    }

    function calculateGeneratorFuelCost() {
      const litres = parseFloat(document.getElementById('generator_fuel_litres').value) || 0;
      const prixUnitaire = parseFloat(document.getElementById('generator_fuel_prix_unitaire').value) || 0;
      
      document.getElementById('generator_fuel_cout').value = (litres * prixUnitaire).toFixed(2);
    }

    // Data Persistence
    function saveData() {
      localStorage.setItem('vehicles', JSON.stringify(vehicles));
      localStorage.setItem('fuelRecords', JSON.stringify(fuelRecords));
      localStorage.setItem('maintenanceRecords', JSON.stringify(maintenanceRecords));
      localStorage.setItem('bikes', JSON.stringify(bikes));
      localStorage.setItem('bikeFuelRecords', JSON.stringify(bikeFuelRecords));
      localStorage.setItem('bikeMaintenanceRecords', JSON.stringify(bikeMaintenanceRecords));
      localStorage.setItem('generators', JSON.stringify(generators));
      localStorage.setItem('generatorFuelRecords', JSON.stringify(generatorFuelRecords));
      localStorage.setItem('generatorMaintenanceRecords', JSON.stringify(generatorMaintenanceRecords));
      localStorage.setItem('history', JSON.stringify(history));
    }

    // Toast Notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Export to Excel (Basic implementation)
    function exportToExcel() {
      // This is a simplified version - in a real app, you would use a library like SheetJS
      let csvContent = "data:text/csv;charset=utf-8,";
      
      // Determine which tab is active
      const activeTab = document.querySelector('.tab-content.active').id;
      
      if (activeTab === 'vehicles-tab') {
        csvContent += "Immatriculation,Marque/Mod√®le,Type,Statut,Chauffeur\n";
        vehicles.forEach(vehicle => {
          csvContent += `${vehicle.immatriculation},${vehicle.marque},${vehicle.type},${vehicle.statut},${vehicle.chauffeur || ''}\n`;
        });
      } else if (activeTab === 'bikes-tab') {
        csvContent += "Immatriculation,Marque/Mod√®le,Type,Statut,Livreur\n";
        bikes.forEach(bike => {
          csvContent += `${bike.immatriculation},${bike.marque},${bike.type},${bike.statut},${bike.chauffeur || ''}\n`;
        });
      } else if (activeTab === 'generators-tab') {
        csvContent += "Num√©ro,Marque/Mod√®le,Puissance,Statut,Localisation\n";
        generators.forEach(generator => {
          csvContent += `${generator.numero},${generator.marque},${generator.puissance},${generator.statut},${generator.localisation || ''}\n`;
        });
      }
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `export_${activeTab.replace('-tab', '')}_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('Export CSV g√©n√©r√© avec succ√®s');
    }
  </script>
</body>
</html>
