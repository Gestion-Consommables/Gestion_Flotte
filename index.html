<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Flottes - Poste Guin√©enne</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Base Styles & Variables */
    :root {
      --primary-color: #3498db;
      --secondary-color: #2ecc71;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
      --text-color: #333;
      --text-light: #7f8c8d;
      --border-color: #ddd;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    [data-theme="dark"] {
      --primary-color: #2980b9;
      --secondary-color: #27ae60;
      --dark-color: #ecf0f1;
      --light-color: #2c3e50;
      --text-color: #ecf0f1;
      --text-light: #bdc3c7;
      --border-color: #34495e;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: #f5f7fa;
      transition: var(--transition);
    }

    [data-theme="dark"] body {
      background-color: #1a1a1a;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    .app-header {
      background-color: var(--dark-color);
      color: white;
      padding: 1rem 0;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }

    .app-header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Nouveaux styles pour le logo */
    .header-logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .header-logo {
      height: 50px;
      display: flex;
      align-items: center;
      background-color: #1a3a6d;
      padding: 0 15px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .logo-text {
      text-align: center;
      line-height: 1.2;
      font-weight: bold;
      color: white;
    }
    
    .logo-main {
      font-size: 18px;
      text-transform: uppercase;
    }
    
    .logo-sub {
      font-size: 14px;
    }
    
    .logo-slogan {
      font-size: 10px;
      color: #f9c642;
      margin-top: 2px;
    }

    .app-header h1 {
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    /* Tab Navigation */
    .nav-tabs {
      display: flex;
      gap: 5px;
      margin-right: 15px;
    }

    .nav-tab {
      padding: 8px 15px;
      background: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      color: white;
    }

    .nav-tab.active {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .nav-tab:not(.active):hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Grid Layout */
    .grid-layout {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 2rem;
    }

    /* Card Styles */
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: var(--transition);
    }

    [data-theme="dark"] .card {
      background-color: #252525;
    }

    .card-header {
      padding: 1rem;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h2 {
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      padding: 1rem;
    }

    /* Form Styles */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-color);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 1rem;
      transition: var(--transition);
      background-color: var(--light-color);
      color: var(--text-color);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .search-box {
      position: relative;
      width: 200px;
    }

    .search-box input {
      width: 100%;
      padding: 8px 30px 8px 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }

    .search-box i {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
    }

    /* Button Styles */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: #2980b9;
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background-color: #27ae60;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-color);
    }

    .btn-outline:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }

    /* Table Styles */
    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
    }

    tr:hover {
      background-color: rgba(0, 0, 0, 0.02);
    }

    [data-theme="dark"] tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      font-size: 0.9rem;
    }

    .pagination {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pagination button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--primary-color);
      font-size: 1rem;
    }

    .pagination button:disabled {
      color: var(--text-light);
      cursor: not-allowed;
    }

    /* Timeline Styles */
    .timeline {
      position: relative;
      padding-left: 30px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: var(--primary-color);
    }

    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -30px;
      top: 5px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: var(--primary-color);
    }

    .timeline-date {
      font-size: 0.8rem;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .timeline-content {
      background-color: var(--light-color);
      padding: 10px 15px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background-color: white;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .modal-content {
      background-color: #252525;
    }

    .modal-header {
      padding: 15px 20px;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 15px 20px;
      display: flex;
      justify-content: flex-end;
      border-top: 1px solid var(--border-color);
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: white;
    }

    /* Toast Styles */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--dark-color);
      color: white;
      padding: 15px 20px;
      border-radius: 4px;
      box-shadow: var(--shadow);
      transform: translateY(100px);
      opacity: 0;
      transition: var(--transition);
      z-index: 1100;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Bike Specific Styles */
    .bike-status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .bike-status.en-service {
      background-color: #d4edda;
      color: #155724;
    }

    .bike-status.en-panne {
      background-color: #f8d7da;
      color: #721c24;
    }

    .bike-status.en-maintenance {
      background-color: #fff3cd;
      color: #856404;
    }

    [data-theme="dark"] .bike-status.en-service {
      background-color: #155724;
      color: #d4edda;
    }

    [data-theme="dark"] .bike-status.en-panne {
      background-color: #721c24;
      color: #f8d7da;
    }

    [data-theme="dark"] .bike-status.en-maintenance {
      background-color: #856404;
      color: #fff3cd;
    }

    /* Vehicle/Bike Details in Modal */
    .detail-item {
      margin-bottom: 15px;
    }

    .detail-label {
      font-weight: 600;
      display: block;
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .detail-value {
      display: block;
    }

    .full-width {
      width: 100%;
    }

    .maintenance-title {
      margin: 20px 0 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid var(--border-color);
    }

    .maintenance-item {
      padding: 10px;
      margin-bottom: 10px;
      background-color: var(--light-color);
      border-radius: 4px;
    }

    .maintenance-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .maintenance-type {
      font-weight: 600;
    }

    .maintenance-date {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .maintenance-cost {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .maintenance-description {
      font-size: 0.9rem;
    }

    /* Utility Classes */
    .mb-3 { margin-bottom: 1rem; }
    .mt-3 { margin-top: 1rem; }
    .text-center { text-align: center; }
    .d-flex { display: flex; }
    .align-center { align-items: center; }
    .justify-between { justify-content: space-between; }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .app-header .container {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .header-logo-container {
        flex-direction: column;
        text-align: center;
      }
      
      .header-logo {
        margin-bottom: 10px;
      }
      
      .header-actions {
        width: 100%;
        justify-content: center;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .table-footer {
        flex-direction: column;
        gap: 15px;
      }
      
      .modal-content {
        width: 95%;
      }
    }

    @media (max-width: 480px) {
      .card-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .nav-tabs {
        margin-right: 0;
        margin-bottom: 10px;
      }
      
      .header-logo {
        height: 40px;
        padding: 0 10px;
      }
      
      .logo-main {
        font-size: 16px;
      }
      
      .logo-sub {
        font-size: 12px;
      }
      
      .logo-slogan {
        font-size: 9px;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="container">
      <div class="header-logo-container">
        <div class="header-logo">
          <!-- Logo La Poste Guin√©enne -->
          <div class="logo-text">
            <div class="logo-main">LA POSTE</div>
            <div class="logo-sub">GUIN√âENNE</div>
            <div class="logo-slogan">Confiance - Innovation - Proximit√©</div>
          </div>
        </div>
        <h1><i class="fas fa-truck-moving"></i> Gestion des Flottes</h1>
      </div>
      <div class="header-actions">
        <div class="nav-tabs">
          <button class="nav-tab active" data-tab="vehicles"><i class="fas fa-car"></i> V√©hicules</button>
          <button class="nav-tab" data-tab="bikes"><i class="fas fa-bicycle"></i> Motos</button>
          <button class="nav-tab" data-tab="generators"><i class="fas fa-bolt"></i> Groupes √âlectrog√®nes</button>
        </div>
        <button id="export-excel" class="btn btn-primary"><i class="fas fa-file-excel"></i> Exporter Excel</button>
        <button id="toggle-theme" class="btn btn-secondary"><i class="fas fa-moon"></i></button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Vehicles Tab Content -->
    <div id="vehicles-tab" class="tab-content active">
      <div class="grid-layout">
        <!-- Vehicle Form Section -->
        <section id="form-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-car"></i> Ajouter/Modifier un V√©hicule</h2>
            <button id="clear-form" class="btn btn-sm btn-outline">Nouveau</button>
          </div>
          <div class="card-body">
            <form id="vehicule-form" class="form-grid">
              <div class="form-group">
                <label for="immatriculation">Immatriculation</label>
                <input type="text" id="immatriculation" placeholder="Ex: ABC1234" required />
              </div>
              
              <div class="form-group">
                <label for="marque">Marque/Mod√®le</label>
                <input type="text" id="marque" placeholder="Ex: Toyota Hilux" required />
              </div>
              
              <div class="form-group">
                <label for="type">Type</label>
                <select id="type" required>
                  <option value="">S√©lectionner...</option>
                  <option value="voiture">Voiture</option>
                  <option value="camion">Camion</option>
                  <option value="bus">Bus</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <!-- Champ de date modifi√© pour accepter le format JJ MM AAAA -->
              <div class="form-group">
                <label for="date_circulation">Date de mise en circulation</label>
                <input type="text" id="date_circulation" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e (ex: 15 03 2020)</small>
              </div>
              
              <div class="form-group">
                <label for="statut">Statut</label>
                <select id="statut" required>
                  <option value="en service">En service</option>
                  <option value="en panne">En panne</option>
                  <option value="en maintenance">En maintenance</option>
                  <option value="hors service">Hors service</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="chauffeur">Chauffeur assign√©</label>
                <input type="text" id="chauffeur" placeholder="Nom et pr√©nom du chauffeur" />
              </div>
              
              <div class="form-group full-width">
                <label for="observations">Observations</label>
                <textarea id="observations" placeholder="Notes sur l'√©tat du v√©hicule"></textarea>
              </div>
              
              <!-- Section Gestion des D√©placements -->
              <div class="form-group">
                <label for="departement">D√©partement Utilisateur</label>
                <select id="departement" required>
                  <option value="">S√©lectionner...</option>
                  <option value="DG">Direction G√©n√©rale (DG)</option>
                  <option value="DGA">Direction G√©n√©rale Adjointe (DGA)</option>
                  <option value="DSI">Direction des Syst√®mes d'Information (DSI)</option>
                  <option value="DSP">Direction des Services Postaux (DSP)</option>
                  <option value="DRH">Direction des Ressources Humaines (DRH)</option>
                  <option value="DPLMG">Direction de la Logistique et Moyens G√©n√©raux (DPLMG)</option>
                  <option value="DSPS">Direction de la S√©curit√© et Protection Sociale (DSPS)</option>
                  <option value="DACQ">Direction des Achats (DACQ)</option>
                  <option value="DSJ">Direction des Services Juridiques (DSJ)</option>
                  <option value="DAF">Direction des Affaires Financi√®res (DAF)</option>
                </select>
              </div>

              <div class="form-group">
                <label for="destination">Destination</label>
                <input type="text" id="destination" placeholder="Lieu de destination" />
              </div>

              <div class="form-group">
                <label for="motif_deplacement">Motif du D√©placement</label>
                <input type="text" id="motif_deplacement" placeholder="Raison du d√©placement" />
              </div>

              <div class="form-group">
                <label for="km_avant">Kilom√©trage Avant D√©placement</label>
                <input type="number" id="km_avant" placeholder="Kilom√©trage au d√©part" />
              </div>

              <div class="form-group">
                <label for="km_apres">Kilom√©trage Apr√®s D√©placement</label>
                <input type="number" id="km_apres" placeholder="Kilom√©trage √† l'arriv√©e" />
              </div>

              <div class="form-group">
                <label for="km_parcouru">Kilom√©trage Parcouru (calcul√© automatiquement)</label>
                <input type="number" id="km_parcouru" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-actions full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
                <button type="button" id="cancel-edit" class="btn btn-outline">Annuler</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Fuel Section MODIFI√âE -->
        <section id="carburant-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-gas-pump"></i> Ravitaillement en carburant</h2>
          </div>
          <div class="card-body">
            <form id="carburant-form" class="form-grid">
              <div class="form-group">
                <label for="carburant_vehicule">V√©hicule</label>
                <select id="carburant_vehicule" required>
                  <option value="">S√©lectionner un v√©hicule...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="carburant_date">Date</label>
                <input type="text" id="carburant_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="carburant_km_depart">Kilom√©trage D√©part</label>
                <input type="number" id="carburant_km_depart" placeholder="Km au d√©part" required />
              </div>
              
              <div class="form-group">
                <label for="carburant_km_arrivee">Kilom√©trage Arriv√©e Station</label>
                <input type="number" id="carburant_km_arrivee" placeholder="Km √† l'arriv√©e station" required />
              </div>
              
              <div class="form-group">
                <label for="carburant_km_parcouru">Kilom√©trage Parcouru (calcul√©)</label>
                <input type="number" id="carburant_km_parcouru" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group">
                <label for="carburant_litres">Quantit√© Ravitaill√©e (L)</label>
                <input type="number" step="0.1" id="carburant_litres" placeholder="Ex: 45.5" required />
              </div>
              
              <!-- NOUVEAU CHAMP MODIFI√â : Consommation manuelle -->
              <div class="form-group">
                <label for="carburant_consommation_100km">Consommation sur 100 Km</label>
                <input type="number" step="0.1" id="carburant_consommation_100km" placeholder="Saisir la consommation" />
              </div>
              
              <div class="form-group">
                <label for="carburant_prix_unitaire">Prix Unitaire (GNF)</label>
                <input type="number" step="0.01" id="carburant_prix_unitaire" placeholder="Ex: 1250" required />
              </div>
              
              <div class="form-group">
                <label for="carburant_type">Type de carburant</label>
                <select id="carburant_type" required>
                  <option value="gasoil">Gasoil</option>
                  <option value="essence">Essence</option>
                  <option value="gnc">GNC</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="carburant_cout">Co√ªt Total (calcul√©)</label>
                <input type="number" step="0.01" id="carburant_cout" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Ravitaillement</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Vehicle Maintenance Section -->
        <section id="vehicle-maintenance-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-tools"></i> Maintenance des V√©hicules</h2>
          </div>
          <div class="card-body">
            <form id="vehicle-maintenance-form" class="form-grid">
              <div class="form-group">
                <label for="vehicle_maintenance_vehicule">V√©hicule</label>
                <select id="vehicle_maintenance_vehicule" required>
                  <option value="">S√©lectionner un v√©hicule...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="vehicle_maintenance_date">Date</label>
                <input type="text" id="vehicle_maintenance_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="vehicle_maintenance_type">Type de maintenance</label>
                <select id="vehicle_maintenance_type" required>
                  <option value="entretien_kilometrique">Entretien kilom√©trique</option>
                  <option value="freins">Freins</option>
                  <option value="pneus">Pneus</option>
                  <option value="climatisation">Climatisation</option>
                  <option value="electrique">Probl√®me √©lectrique</option>
                  <option value="moteur">Probl√®me de moteur</option>
                  <option value="carrosserie">Probl√®me de carrosserie</option>
                  <option value="suspension">Probl√®me de suspension</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="vehicle_maintenance_cout">Co√ªt (GNF)</label>
                <input type="number" step="0.01" id="vehicle_maintenance_cout" placeholder="Ex: 325000" required />
              </div>
              
              <div class="form-group full-width">
                <label for="vehicle_maintenance_description">Description</label>
                <textarea id="vehicle_maintenance_description" placeholder="D√©tails de la maintenance, pi√®ces remplac√©es..."></textarea>
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Maintenance</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Vehicles List -->
        <section id="vehicules-list" class="card">
          <div class="card-header">
            <h2><i class="fas fa-list"></i> Liste des V√©hicules</h2>
            <div class="search-box">
              <input type="text" id="search-vehicule" placeholder="Rechercher v√©hicule...">
              <i class="fas fa-search"></i>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="vehicules-table">
                <thead>
                  <tr>
                    <th>Immat.</th>
                    <th>Marque/Mod√®le</th>
                    <th>Type</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="liste-vehicules">
                  <!-- Donn√©es dynamiques -->
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info" id="vehicule-count">0 v√©hicules</div>
              <div class="pagination">
                <button id="prev-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="page-info">Page 1</span>
                <button id="next-page" disabled><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        </section>

        <!-- History Section -->
        <section id="historique-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-history"></i> Historique des Actions</h2>
            <div class="filter-actions">
              <select id="filter-type">
                <option value="all">Tous les types</option>
                <option value="vehicle">V√©hicules</option>
                <option value="fuel">Carburant</option>
                <option value="maintenance">Maintenance</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline" id="historique">
              <!-- Historique dynamique -->
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Bikes Tab Content -->
    <div id="bikes-tab" class="tab-content">
      <div class="grid-layout">
        <!-- Bike Form Section -->
        <section id="bike-form-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-bicycle"></i> Ajouter/Modifier une Moto</h2>
            <button id="clear-bike-form" class="btn btn-sm btn-outline">Nouveau</button>
          </div>
          <div class="card-body">
            <form id="bike-form" class="form-grid">
              <div class="form-group">
                <label for="bike_immatriculation">Immatriculation</label>
                <input type="text" id="bike_immatriculation" placeholder="Ex: MOTO1234" required />
              </div>
              
              <div class="form-group">
                <label for="bike_marque">Marque/Mod√®le</label>
                <input type="text" id="bike_marque" placeholder="Ex: Yamaha XTZ" required />
              </div>
              
              <div class="form-group">
                <label for="bike_type">Type</label>
                <select id="bike_type" required>
                  <option value="">S√©lectionner...</option>
                  <option value="moto_cross">Moto Cross</option>
                  <option value="moto_routiere">Moto Routi√®re</option>
                  <option value="scooter">Scooter</option>
                  <option value="tricycle">Tricycle</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <!-- Champ de date modifi√© pour accepter le format JJ MM AAAA -->
              <div class="form-group">
                <label for="bike_date_circulation">Date de mise en circulation</label>
                <input type="text" id="bike_date_circulation" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e (ex: 15 03 2020)</small>
              </div>
              
              <div class="form-group">
                <label for="bike_statut">Statut</label>
                <select id="bike_statut" required>
                  <option value="en service">En service</option>
                  <option value="en panne">En panne</option>
                  <option value="en maintenance">En maintenance</option>
                  <option value="hors service">Hors service</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_chauffeur">Livreur assign√©</label>
                <input type="text" id="bike_chauffeur" placeholder="Nom et pr√©nom du livreur" />
              </div>
              
              <div class="form-group full-width">
                <label for="bike_observations">Observations</label>
                <textarea id="bike_observations" placeholder="Notes sur l'√©tat de la moto"></textarea>
              </div>
              
              <div class="form-actions full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
                <button type="button" id="cancel-bike-edit" class="btn btn-outline">Annuler</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Bike Fuel Section MODIFI√âE -->
        <section id="bike-carburant-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-gas-pump"></i> Ravitaillement en carburant (Motos)</h2>
          </div>
          <div class="card-body">
            <form id="bike-carburant-form" class="form-grid">
              <div class="form-group">
                <label for="bike_carburant_moto">Moto</label>
                <select id="bike_carburant_moto" required>
                  <option value="">S√©lectionner une moto...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_date">Date</label>
                <input type="text" id="bike_carburant_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_km_depart">Kilom√©trage D√©part</label>
                <input type="number" id="bike_carburant_km_depart" placeholder="Km au d√©part" required />
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_km_arrivee">Kilom√©trage Arriv√©e Station</label>
                <input type="number" id="bike_carburant_km_arrivee" placeholder="Km √† l'arriv√©e station" required />
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_km_parcouru">Kilom√©trage Parcouru (calcul√©)</label>
                <input type="number" id="bike_carburant_km_parcouru" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_litres">Quantit√© Ravitaill√©e (L)</label>
                <input type="number" step="0.1" id="bike_carburant_litres" placeholder="Ex: 10.5" required />
              </div>
              
              <!-- NOUVEAU CHAMP MODIFI√â : Consommation manuelle -->
              <div class="form-group">
                <label for="bike_carburant_consommation_100km">Consommation sur 100 Km</label>
                <input type="number" step="0.1" id="bike_carburant_consommation_100km" placeholder="Saisir la consommation" />
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_prix_unitaire">Prix Unitaire (GNF)</label>
                <input type="number" step="0.01" id="bike_carburant_prix_unitaire" placeholder="Ex: 1250" required />
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_type">Type de carburant</label>
                <select id="bike_carburant_type" required>
                  <option value="essence">Essence</option>
                  <option value="gasoil">Gasoil</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="bike_carburant_cout">Co√ªt Total (calcul√©)</label>
                <input type="number" step="0.01" id="bike_carburant_cout" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Ravitaillement</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Bike Maintenance Section -->
        <section id="bike-maintenance-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-tools"></i> Maintenance des Motos</h2>
          </div>
          <div class="card-body">
            <form id="bike-maintenance-form" class="form-grid">
              <div class="form-group">
                <label for="maintenance_bike">Moto</label>
                <select id="maintenance_bike" required>
                  <option value="">S√©lectionner une moto...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="maintenance_date">Date</label>
                <input type="text" id="maintenance_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="maintenance_type">Type de maintenance</label>
                <select id="maintenance_type" required>
                  <option value="entretien_kilometrique">Entretien kilom√©trique</option>
                  <option value="freins">Freins</option>
                  <option value="pneus">Pneus</option>
                  <option value="electrique">Probl√®me √©lectrique</option>
                  <option value="moteur">Probl√®me de moteur</option>
                  <option value="carrosserie">Probl√®me de carrosserie</option>
                  <option value="suspension">Probl√®me de suspension</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="maintenance_cout">Co√ªt (GNF)</label>
                <input type="number" step="0.01" id="maintenance_cout" placeholder="Ex: 125000" required />
              </div>
              
              <div class="form-group full-width">
                <label for="maintenance_description">Description</label>
                <textarea id="maintenance_description" placeholder="D√©tails de la maintenance"></textarea>
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Maintenance</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Bikes List -->
        <section id="bikes-list" class="card">
          <div class="card-header">
            <h2><i class="fas fa-list"></i> Liste des Motos</h2>
            <div class="search-box">
              <input type="text" id="search-bike" placeholder="Rechercher moto...">
              <i class="fas fa-search"></i>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="bikes-table">
                <thead>
                  <tr>
                    <th>Immat.</th>
                    <th>Marque/Mod√®le</th>
                    <th>Type</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="liste-bikes">
                  <!-- Donn√©es dynamiques -->
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info" id="bike-count">0 motos</div>
              <div class="pagination">
                <button id="prev-bike-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="bike-page-info">Page 1</span>
                <button id="next-bike-page" disabled><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        </section>

        <!-- Bike History Section -->
        <section id="bike-history-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-history"></i> Historique des Motos</h2>
            <div class="filter-actions">
              <select id="bike-filter-type">
                <option value="all">Tous les types</option>
                <option value="bike">Motos</option>
                <option value="maintenance">Maintenance</option>
                <option value="fuel">Carburant</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline" id="bike-history">
              <!-- Historique dynamique -->
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Generators Tab Content -->
    <div id="generators-tab" class="tab-content">
      <div class="grid-layout">
        <!-- Generator Form Section -->
        <section id="generator-form-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-bolt"></i> Ajouter/Modifier un Groupe √âlectrog√®ne</h2>
            <button id="clear-generator-form" class="btn btn-sm btn-outline">Nouveau</button>
          </div>
          <div class="card-body">
            <form id="generator-form" class="form-grid">
              <div class="form-group">
                <label for="generator_immatriculation">Num√©ro d'inventaire</label>
                <input type="text" id="generator_immatriculation" placeholder="Ex: GEN001" required />
              </div>
              
              <div class="form-group">
                <label for="generator_marque">Marque/Mod√®le</label>
                <input type="text" id="generator_marque" placeholder="Ex: Caterpillar 500kVA" required />
              </div>
              
              <div class="form-group">
                <label for="generator_type">Type</label>
                <select id="generator_type" required>
                  <option value="">S√©lectionner...</option>
                  <option value="diesel">Diesel</option>
                  <option value="essence">Essence</option>
                  <option value="gaz">Gaz</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_puissance">Puissance (kVA)</label>
                <input type="number" id="generator_puissance" placeholder="Ex: 500" required />
              </div>
              
              <div class="form-group">
                <label for="generator_date_mise_service">Date de mise en service</label>
                <input type="text" id="generator_date_mise_service" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="generator_statut">Statut</label>
                <select id="generator_statut" required>
                  <option value="en service">En service</option>
                  <option value="en panne">En panne</option>
                  <option value="en maintenance">En maintenance</option>
                  <option value="hors service">Hors service</option>
                </select>
              </div>
              
              <div class="form-group full-width">
                <label for="generator_observations">Observations</label>
                <textarea id="generator_observations" placeholder="Notes sur l'√©tat du groupe √©lectrog√®ne"></textarea>
              </div>
              
              <div class="form-actions full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Enregistrer</button>
                <button type="button" id="cancel-generator-edit" class="btn btn-outline">Annuler</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Generator Fuel Section MODIFI√â - Champs manuels -->
        <section id="generator-carburant-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-gas-pump"></i> Ravitaillement Groupes √âlectrog√®nes</h2>
          </div>
          <div class="card-body">
            <form id="generator-carburant-form" class="form-grid">
              <div class="form-group">
                <label for="generator_carburant_groupe">Groupe √âlectrog√®ne</label>
                <select id="generator_carburant_groupe" required>
                  <option value="">S√©lectionner un groupe...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_carburant_date">Date</label>
                <input type="text" id="generator_carburant_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="generator_carburant_quantite_ravitailler">Quantit√© ravitaill√©e (L)</label>
                <input type="number" step="0.1" id="generator_carburant_quantite_ravitailler" placeholder="Ex: 45.5" required />
              </div>
              
              <div class="form-group">
                <label for="generator_carburant_heure_allumage">Heure d'allumage</label>
                <input type="time" id="generator_carburant_heure_allumage" required />
              </div>
              
              <div class="form-group">
                <label for="generator_carburant_heure_extinction">Heure d'extinction</label>
                <input type="time" id="generator_carburant_heure_extinction" required />
              </div>
              
              <!-- MODIFI√â : Temps de fonctionnement (manuel) -->
              <div class="form-group">
                <label for="generator_carburant_temps_fonctionnement">Temps de fonctionnement (manuel)</label>
                <input type="text" id="generator_carburant_temps_fonctionnement" placeholder="Ex: 08:30" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: HH:MM (ex: 08:30 pour 8h30)</small>
              </div>
              
              <!-- MODIFI√â : Quantit√© consomm√©e par heure (manuel) -->
              <div class="form-group">
                <label for="generator_carburant_quantite_consommee_heure">Quantit√© consomm√©e par heure (L/h) (manuel)</label>
                <input type="number" step="0.1" id="generator_carburant_quantite_consommee_heure" placeholder="Ex: 12.5" required />
              </div>
              
              <div class="form-group">
                <label for="generator_carburant_prix_unitaire">Prix Unitaire (GNF)</label>
                <input type="number" step="0.01" id="generator_carburant_prix_unitaire" placeholder="Ex: 1250" required />
              </div>
              
              <div class="form-group">
                <label for="generator_carburant_cout">Co√ªt Total (calcul√©)</label>
                <input type="number" step="0.01" id="generator_carburant_cout" placeholder="Calcul automatique" readonly />
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Ravitaillement</button>
              </div>
            </form>
          </div>
        </section>

        <!-- NOUVELLE SECTION : Maintenance des Groupes √âlectrog√®nes -->
        <section id="generator-maintenance-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-tools"></i> Maintenance des Groupes √âlectrog√®nes</h2>
          </div>
          <div class="card-body">
            <form id="generator-maintenance-form" class="form-grid">
              <div class="form-group">
                <label for="generator_maintenance_groupe">Groupe √âlectrog√®ne</label>
                <select id="generator_maintenance_groupe" required>
                  <option value="">S√©lectionner un groupe...</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_maintenance_date">Date</label>
                <input type="text" id="generator_maintenance_date" placeholder="JJ MM AAAA" required />
                <small style="color: var(--text-light); font-size: 0.8rem;">Format: Jour Mois Ann√©e</small>
              </div>
              
              <div class="form-group">
                <label for="generator_maintenance_type">Type de maintenance</label>
                <select id="generator_maintenance_type" required>
                  <option value="entretien_preventif">Entretien pr√©ventif</option>
                  <option value="entretien_correctif">Entretien correctif</option>
                  <option value="changement_filtres">Changement des filtres</option>
                  <option value="vidange_huile">Vidange d'huile</option>
                  <option value="nettoyage_injecteurs">Nettoyage injecteurs</option>
                  <option value="revision_moteur">R√©vision moteur</option>
                  <option value="controle_electrique">Contr√¥le √©lectrique</option>
                  <option value="changement_batterie">Changement batterie</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="generator_maintenance_cout">Co√ªt (GNF)</label>
                <input type="number" step="0.01" id="generator_maintenance_cout" placeholder="Ex: 450000" required />
              </div>
              
              <div class="form-group full-width">
                <label for="generator_maintenance_description">Description</label>
                <textarea id="generator_maintenance_description" placeholder="D√©tails de la maintenance, pi√®ces remplac√©es..."></textarea>
              </div>
              
              <div class="form-group full-width">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Ajouter Maintenance</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Generators List -->
        <section id="generators-list" class="card">
          <div class="card-header">
            <h2><i class="fas fa-list"></i> Liste des Groupes √âlectrog√®nes</h2>
            <div class="search-box">
              <input type="text" id="search-generator" placeholder="Rechercher groupe...">
              <i class="fas fa-search"></i>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="generators-table">
                <thead>
                  <tr>
                    <th>N¬∞ Inventaire</th>
                    <th>Marque/Mod√®le</th>
                    <th>Puissance</th>
                    <th>Type</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="liste-generators">
                  <!-- Donn√©es dynamiques -->
                </tbody>
              </table>
            </div>
            <div class="table-footer">
              <div class="table-info" id="generator-count">0 groupes</div>
              <div class="pagination">
                <button id="prev-generator-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="generator-page-info">Page 1</span>
                <button id="next-generator-page" disabled><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        </section>

        <!-- Generator History Section -->
        <section id="generator-history-section" class="card">
          <div class="card-header">
            <h2><i class="fas fa-history"></i> Historique des Groupes √âlectrog√®nes</h2>
            <div class="filter-actions">
              <select id="generator-filter-type">
                <option value="all">Tous les types</option>
                <option value="generator">Groupes</option>
                <option value="fuel">Carburant</option>
                <option value="maintenance">Maintenance</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline" id="generator-history">
              <!-- Historique dynamique -->
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Modals -->
  <div id="vehicle-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">D√©tails du V√©hicule</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="vehicle-details">
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Fermer</button>
      </div>
    </div>
  </div>

  <div id="bike-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="bike-modal-title">D√©tails de la Moto</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="bike-details">
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Fermer</button>
      </div>
    </div>
  </div>

  <div id="generator-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="generator-modal-title">D√©tails du Groupe √âlectrog√®ne</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="generator-details">
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline close-modal">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Toast notifications -->
  <div id="toast" class="toast"></div>

  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script>
    // Theme Switching
    document.getElementById('toggle-theme').addEventListener('click', function() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? '' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      this.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      localStorage.setItem('fleet_theme', newTheme);
    });

    // Initialize theme from localStorage
    const savedTheme = localStorage.getItem('fleet_theme') || '';
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('toggle-theme').innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';

    // Tab Switching
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        const tabId = tab.getAttribute('data-tab') + '-tab';
        document.getElementById(tabId).classList.add('active');
      });
    });

    // Data Management
    let vehicles = JSON.parse(localStorage.getItem('fleet_vehicles')) || [];
    let fuelRecords = JSON.parse(localStorage.getItem('fleet_fuel')) || [];
    let bikes = JSON.parse(localStorage.getItem('fleet_bikes')) || [];
    let bikeMaintenance = JSON.parse(localStorage.getItem('fleet_bike_maintenance')) || [];
    let vehicleMaintenance = JSON.parse(localStorage.getItem('fleet_vehicle_maintenance')) || [];
    let bikeFuelRecords = JSON.parse(localStorage.getItem('fleet_bike_fuel')) || [];
    let generators = JSON.parse(localStorage.getItem('fleet_generators')) || [];
    let generatorFuelRecords = JSON.parse(localStorage.getItem('fleet_generator_fuel')) || [];
    let generatorMaintenance = JSON.parse(localStorage.getItem('fleet_generator_maintenance')) || [];

    // Fonction pour convertir le format JJ MM AAAA en format date standard (YYYY-MM-DD)
    function convertToStandardDate(dateString) {
      if (!dateString) return '';
      
      // Supprimer les espaces multiples et diviser la cha√Æne
      const parts = dateString.trim().split(/\s+/);
      
      if (parts.length !== 3) {
        return dateString; // Retourner la cha√Æne originale si le format n'est pas valide
      }
      
      const [day, month, year] = parts;
      
      // Formater en YYYY-MM-DD pour le stockage
      const formattedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
      
      // V√©rifier si la date est valide
      const date = new Date(formattedDate);
      if (isNaN(date.getTime())) {
        return dateString; // Retourner la cha√Æne originale si la date n'est pas valide
      }
      
      return formattedDate;
    }

    // Fonction pour formater la date en format fran√ßais (JJ/MM/AAAA)
    function formatToFrenchDate(dateString) {
      if (!dateString) return '';
      
      // Si c'est d√©j√† au format YYYY-MM-DD, le convertir
      if (dateString.match(/^\d{4}-\d{2}-\d{2}$/)) {
        const [year, month, day] = dateString.split('-');
        return `${day}/${month}/${year}`;
      }
      
      // Si c'est au format JJ MM AAAA, le formater en JJ/MM/AAAA
      if (dateString.match(/^\d{1,2}\s+\d{1,2}\s+\d{4}$/)) {
        const parts = dateString.trim().split(/\s+/);
        const [day, month, year] = parts;
        return `${day.padStart(2, '0')}/${month.padStart(2, '0')}/${year}`;
      }
      
      return dateString;
    }

    // Fonction pour formater la date pour l'affichage (JJ MM AAAA)
    function formatForDisplay(dateString) {
      if (!dateString) return '';
      
      // Si c'est au format YYYY-MM-DD, le convertir en JJ MM AAAA
      if (dateString.match(/^\d{4}-\d{2}-\d{2}$/)) {
        const [year, month, day] = dateString.split('-');
        return `${parseInt(day)} ${parseInt(month)} ${year}`;
      }
      
      return dateString;
    }

    // Vehicle Form Handling
    document.getElementById('vehicule-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const dateCirculation = convertToStandardDate(document.getElementById('date_circulation').value);
      
      const vehicleData = {
        id: Date.now().toString(),
        immatriculation: document.getElementById('immatriculation').value,
        marque: document.getElementById('marque').value,
        type: document.getElementById('type').value,
        date_circulation: dateCirculation,
        statut: document.getElementById('statut').value,
        chauffeur: document.getElementById('chauffeur').value,
        observations: document.getElementById('observations').value,
        departement: document.getElementById('departement').value,
        destination: document.getElementById('destination').value,
        motif_deplacement: document.getElementById('motif_deplacement').value,
        km_avant: document.getElementById('km_avant').value,
        km_apres: document.getElementById('km_apres').value,
        km_parcouru: document.getElementById('km_parcouru').value,
        last_updated: new Date().toISOString()
      };
      
      const existingVehicleId = this.getAttribute('data-edit-id');
      if (existingVehicleId) {
        const index = vehicles.findIndex(v => v.id === existingVehicleId);
        if (index !== -1) {
          vehicles[index] = {...vehicles[index], ...vehicleData};
        }
      } else {
        vehicles.push(vehicleData);
      }
      
      saveVehicles();
      renderVehiclesList();
      resetVehicleForm();
      showToast('V√©hicule enregistr√© avec succ√®s', 'success');
    });

    function resetVehicleForm() {
      document.getElementById('vehicule-form').reset();
      document.getElementById('vehicule-form').removeAttribute('data-edit-id');
    }

    document.getElementById('clear-form').addEventListener('click', resetVehicleForm);
    document.getElementById('cancel-edit').addEventListener('click', resetVehicleForm);

    // Vehicle Fuel Form Handling with calculations MODIFI√â
    document.getElementById('carburant-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const fuelDate = convertToStandardDate(document.getElementById('carburant_date').value);
      
      const kmDepart = parseFloat(document.getElementById('carburant_km_depart').value);
      const kmArrivee = parseFloat(document.getElementById('carburant_km_arrivee').value);
      const kmParcouru = kmArrivee - kmDepart;
      const litres = parseFloat(document.getElementById('carburant_litres').value);
      const prixUnitaire = parseFloat(document.getElementById('carburant_prix_unitaire').value);
      const coutTotal = litres * prixUnitaire;
      const consommation100km = document.getElementById('carburant_consommation_100km').value;
      
      const fuelData = {
        id: Date.now().toString(),
        vehicle_id: document.getElementById('carburant_vehicule').value,
        date: fuelDate,
        km_depart: kmDepart,
        km_arrivee: kmArrivee,
        km_parcouru: kmParcouru,
        litres: litres,
        consommation_100km: consommation100km,
        prix_unitaire: prixUnitaire,
        cout: coutTotal,
        type: document.getElementById('carburant_type').value,
        created_at: new Date().toISOString()
      };
      
      fuelRecords.push(fuelData);
      saveFuelRecords();
      this.reset();
      renderHistory();
      showToast('Ravitaillement enregistr√© avec succ√®s', 'success');
    });

    // Vehicle Maintenance Form
    document.getElementById('vehicle-maintenance-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const maintenanceDate = convertToStandardDate(document.getElementById('vehicle_maintenance_date').value);
      
      const maintenanceData = {
        id: Date.now().toString(),
        vehicle_id: document.getElementById('vehicle_maintenance_vehicule').value,
        date: maintenanceDate,
        type: document.getElementById('vehicle_maintenance_type').value,
        cout: document.getElementById('vehicle_maintenance_cout').value || 0,
        description: document.getElementById('vehicle_maintenance_description').value,
        created_at: new Date().toISOString()
      };
      
      vehicleMaintenance.push(maintenanceData);
      saveVehicleMaintenance();
      this.reset();
      renderHistory();
      showToast('Maintenance enregistr√©e avec succ√®s', 'success');
    });

    // Bike Form Handling
    document.getElementById('bike-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const dateCirculation = convertToStandardDate(document.getElementById('bike_date_circulation').value);
      
      const bikeData = {
        id: Date.now().toString(),
        immatriculation: document.getElementById('bike_immatriculation').value,
        marque: document.getElementById('bike_marque').value,
        type: document.getElementById('bike_type').value,
        date_circulation: dateCirculation,
        statut: document.getElementById('bike_statut').value,
        chauffeur: document.getElementById('bike_chauffeur').value,
        observations: document.getElementById('bike_observations').value,
        last_updated: new Date().toISOString()
      };
      
      const existingBikeId = this.getAttribute('data-edit-id');
      if (existingBikeId) {
        const index = bikes.findIndex(b => b.id === existingBikeId);
        if (index !== -1) {
          bikes[index] = {...bikes[index], ...bikeData};
        }
      } else {
        bikes.push(bikeData);
      }
      
      saveBikes();
      renderBikesList();
      resetBikeForm();
      showToast('Moto enregistr√©e avec succ√®s', 'success');
    });

    function resetBikeForm() {
      document.getElementById('bike-form').reset();
      document.getElementById('bike-form').removeAttribute('data-edit-id');
    }

    document.getElementById('clear-bike-form').addEventListener('click', resetBikeForm);
    document.getElementById('cancel-bike-edit').addEventListener('click', resetBikeForm);

    // Bike Fuel Form Handling with calculations MODIFI√â
    document.getElementById('bike-carburant-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const fuelDate = convertToStandardDate(document.getElementById('bike_carburant_date').value);
      
      const kmDepart = parseFloat(document.getElementById('bike_carburant_km_depart').value);
      const kmArrivee = parseFloat(document.getElementById('bike_carburant_km_arrivee').value);
      const kmParcouru = kmArrivee - kmDepart;
      const litres = parseFloat(document.getElementById('bike_carburant_litres').value);
      const prixUnitaire = parseFloat(document.getElementById('bike_carburant_prix_unitaire').value);
      const coutTotal = litres * prixUnitaire;
      const consommation100km = document.getElementById('bike_carburant_consommation_100km').value;
      
      const fuelData = {
        id: Date.now().toString(),
        bike_id: document.getElementById('bike_carburant_moto').value,
        date: fuelDate,
        km_depart: kmDepart,
        km_arrivee: kmArrivee,
        km_parcouru: kmParcouru,
        litres: litres,
        consommation_100km: consommation100km,
        prix_unitaire: prixUnitaire,
        cout: coutTotal,
        type: document.getElementById('bike_carburant_type').value,
        created_at: new Date().toISOString()
      };
      
      bikeFuelRecords.push(fuelData);
      saveBikeFuelRecords();
      this.reset();
      renderBikeHistory();
      showToast('Ravitaillement enregistr√© avec succ√®s', 'success');
    });

    // Bike Maintenance Form
    document.getElementById('bike-maintenance-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const maintenanceDate = convertToStandardDate(document.getElementById('maintenance_date').value);
      
      const maintenanceData = {
        id: Date.now().toString(),
        bike_id: document.getElementById('maintenance_bike').value,
        date: maintenanceDate,
        type: document.getElementById('maintenance_type').value,
        cout: document.getElementById('maintenance_cout').value || 0,
        description: document.getElementById('maintenance_description').value,
        created_at: new Date().toISOString()
      };
      
      bikeMaintenance.push(maintenanceData);
      saveBikeMaintenance();
      this.reset();
      renderBikeHistory();
      showToast('Maintenance enregistr√©e avec succ√®s', 'success');
    });

    // Generator Form Handling
    document.getElementById('generator-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const dateMiseService = convertToStandardDate(document.getElementById('generator_date_mise_service').value);
      
      const generatorData = {
        id: Date.now().toString(),
        immatriculation: document.getElementById('generator_immatriculation').value,
        marque: document.getElementById('generator_marque').value,
        type: document.getElementById('generator_type').value,
        puissance: document.getElementById('generator_puissance').value,
        date_mise_service: dateMiseService,
        statut: document.getElementById('generator_statut').value,
        observations: document.getElementById('generator_observations').value,
        last_updated: new Date().toISOString()
      };
      
      const existingGeneratorId = this.getAttribute('data-edit-id');
      if (existingGeneratorId) {
        const index = generators.findIndex(g => g.id === existingGeneratorId);
        if (index !== -1) {
          generators[index] = {...generators[index], ...generatorData};
        }
      } else {
        generators.push(generatorData);
      }
      
      saveGenerators();
      renderGeneratorsList();
      resetGeneratorForm();
      showToast('Groupe √©lectrog√®ne enregistr√© avec succ√®s', 'success');
    });

    function resetGeneratorForm() {
      document.getElementById('generator-form').reset();
      document.getElementById('generator-form').removeAttribute('data-edit-id');
    }

    document.getElementById('clear-generator-form').addEventListener('click', resetGeneratorForm);
    document.getElementById('cancel-generator-edit').addEventListener('click', resetGeneratorForm);

    // Generator Fuel Form Handling with manual fields MODIFI√â
    document.getElementById('generator-carburant-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const fuelDate = convertToStandardDate(document.getElementById('generator_carburant_date').value);
      
      const quantiteRavitailler = parseFloat(document.getElementById('generator_carburant_quantite_ravitailler').value);
      const heureAllumage = document.getElementById('generator_carburant_heure_allumage').value;
      const heureExtinction = document.getElementById('generator_carburant_heure_extinction').value;
      
      // MODIFI√â : R√©cup√©rer les valeurs manuelles
      const tempsFonctionnement = document.getElementById('generator_carburant_temps_fonctionnement').value;
      const quantiteConsommeeHeure = parseFloat(document.getElementById('generator_carburant_quantite_consommee_heure').value);
      
      const prixUnitaire = parseFloat(document.getElementById('generator_carburant_prix_unitaire').value);
      const coutTotal = quantiteRavitailler * prixUnitaire;
      
      const fuelData = {
        id: Date.now().toString(),
        generator_id: document.getElementById('generator_carburant_groupe').value,
        date: fuelDate,
        quantite_ravitailler: quantiteRavitailler,
        heure_allumage: heureAllumage,
        heure_extinction: heureExtinction,
        temps_fonctionnement: tempsFonctionnement,
        quantite_consommee_heure: quantiteConsommeeHeure,
        prix_unitaire: prixUnitaire,
        cout: coutTotal,
        created_at: new Date().toISOString()
      };
      
      generatorFuelRecords.push(fuelData);
      saveGeneratorFuelRecords();
      this.reset();
      renderGeneratorHistory();
      showToast('Ravitaillement enregistr√© avec succ√®s', 'success');
    });

    // NOUVELLE FONCTION : Generator Maintenance Form Handling
    document.getElementById('generator-maintenance-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Convertir la date au format standard pour le stockage
      const maintenanceDate = convertToStandardDate(document.getElementById('generator_maintenance_date').value);
      
      const maintenanceData = {
        id: Date.now().toString(),
        generator_id: document.getElementById('generator_maintenance_groupe').value,
        date: maintenanceDate,
        type: document.getElementById('generator_maintenance_type').value,
        cout: document.getElementById('generator_maintenance_cout').value || 0,
        description: document.getElementById('generator_maintenance_description').value,
        created_at: new Date().toISOString()
      };
      
      generatorMaintenance.push(maintenanceData);
      saveGeneratorMaintenance();
      this.reset();
      renderGeneratorHistory();
      showToast('Maintenance enregistr√©e avec succ√®s', 'success');
    });

    // Fonction pour calculer le temps de fonctionnement (format HH:MM)
    function calculateTempsFonctionnement(heureAllumage, heureExtinction) {
      if (!heureAllumage || !heureExtinction) return '';
      
      const [allumageHeures, allumageMinutes] = heureAllumage.split(':').map(Number);
      const [extinctionHeures, extinctionMinutes] = heureExtinction.split(':').map(Number);
      
      let heuresTotal = extinctionHeures - allumageHeures;
      let minutesTotal = extinctionMinutes - allumageMinutes;
      
      // G√©rer le cas o√π l'extinction est le lendemain
      if (heuresTotal < 0) {
        heuresTotal += 24;
      }
      
      // Ajuster les minutes
      if (minutesTotal < 0) {
        heuresTotal -= 1;
        minutesTotal += 60;
      }
      
      return `${heuresTotal.toString().padStart(2, '0')}:${minutesTotal.toString().padStart(2, '0')}`;
    }

    // Fonction pour calculer les heures en d√©cimales
    function calculateHeuresDecimales(heureAllumage, heureExtinction) {
      if (!heureAllumage || !heureExtinction) return 0;
      
      const [allumageHeures, allumageMinutes] = heureAllumage.split(':').map(Number);
      const [extinctionHeures, extinctionMinutes] = heureExtinction.split(':').map(Number);
      
      let heuresTotal = extinctionHeures - allumageHeures;
      let minutesTotal = extinctionMinutes - allumageMinutes;
      
      // G√©rer le cas o√π l'extinction est le lendemain
      if (heuresTotal < 0) {
        heuresTotal += 24;
      }
      
      // Ajuster les minutes
      if (minutesTotal < 0) {
        heuresTotal -= 1;
        minutesTotal += 60;
      }
      
      // Convertir en heures d√©cimales
      const heuresDecimales = heuresTotal + (minutesTotal / 60);
      return parseFloat(heuresDecimales.toFixed(2));
    }

    // Save Functions
    function saveVehicles() {
      localStorage.setItem('fleet_vehicles', JSON.stringify(vehicles));
    }

    function saveFuelRecords() {
      localStorage.setItem('fleet_fuel', JSON.stringify(fuelRecords));
    }

    function saveBikes() {
      localStorage.setItem('fleet_bikes', JSON.stringify(bikes));
    }

    function saveBikeMaintenance() {
      localStorage.setItem('fleet_bike_maintenance', JSON.stringify(bikeMaintenance));
    }
    
    function saveVehicleMaintenance() {
      localStorage.setItem('fleet_vehicle_maintenance', JSON.stringify(vehicleMaintenance));
    }
    
    function saveBikeFuelRecords() {
      localStorage.setItem('fleet_bike_fuel', JSON.stringify(bikeFuelRecords));
    }

    function saveGenerators() {
      localStorage.setItem('fleet_generators', JSON.stringify(generators));
    }

    function saveGeneratorFuelRecords() {
      localStorage.setItem('fleet_generator_fuel', JSON.stringify(generatorFuelRecords));
    }

    // NOUVELLE FONCTION : Save Generator Maintenance
    function saveGeneratorMaintenance() {
      localStorage.setItem('fleet_generator_maintenance', JSON.stringify(generatorMaintenance));
    }

    // Rendering Functions
    function renderVehiclesList() {
      const container = document.getElementById('liste-vehicules');
      container.innerHTML = '';
      
      vehicles.forEach(vehicle => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${vehicle.immatriculation}</td>
          <td>${vehicle.marque}</td>
          <td>${formatVehicleType(vehicle.type)}</td>
          <td>${formatStatus(vehicle.statut)}</td>
          <td>
            <button class="btn btn-sm btn-outline edit-vehicle" data-id="${vehicle.id}"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline view-vehicle" data-id="${vehicle.id}"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline delete-vehicle" data-id="${vehicle.id}"><i class="fas fa-trash"></i></button>
          </td>
        `;
        container.appendChild(tr);
      });
      
      document.getElementById('vehicule-count').textContent = `${vehicles.length} v√©hicule${vehicles.length !== 1 ? 's' : ''}`;
      
      // Attach event listeners
      document.querySelectorAll('.edit-vehicle').forEach(btn => {
        btn.addEventListener('click', () => editVehicle(btn.getAttribute('data-id')));
      });
      
      document.querySelectorAll('.view-vehicle').forEach(btn => {
        btn.addEventListener('click', () => viewVehicle(btn.getAttribute('data-id')));
      });
      
      document.querySelectorAll('.delete-vehicle').forEach(btn => {
        btn.addEventListener('click', () => deleteVehicle(btn.getAttribute('data-id')));
      });
      
      // Update vehicle dropdown in fuel form
      populateVehicleDropdown();
      populateVehicleMaintenanceDropdown();
    }

    function renderBikesList() {
      const container = document.getElementById('liste-bikes');
      container.innerHTML = '';
      
      bikes.forEach(bike => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${bike.immatriculation}</td>
          <td>${bike.marque}</td>
          <td>${formatBikeType(bike.type)}</td>
          <td><span class="bike-status ${bike.statut.replace(' ', '-')}">${formatStatus(bike.statut)}</span></td>
          <td>
            <button class="btn btn-sm btn-outline edit-bike" data-id="${bike.id}"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline view-bike" data-id="${bike.id}"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline delete-bike" data-id="${bike.id}"><i class="fas fa-trash"></i></button>
          </td>
        `;
        container.appendChild(tr);
      });
      
      document.getElementById('bike-count').textContent = `${bikes.length} moto${bikes.length !== 1 ? 's' : ''}`;
      
      // Attach event listeners
      document.querySelectorAll('.edit-bike').forEach(btn => {
        btn.addEventListener('click', () => editBike(btn.getAttribute('data-id')));
      });
      
      document.querySelectorAll('.view-bike').forEach(btn => {
        btn.addEventListener('click', () => viewBike(btn.getAttribute('data-id')));
      });
      
      document.querySelectorAll('.delete-bike').forEach(btn => {
        btn.addEventListener('click', () => deleteBike(btn.getAttribute('data-id')));
      });
      
      // Update bike dropdown in maintenance form
      populateBikeDropdown();
    }

    function renderGeneratorsList() {
      const container = document.getElementById('liste-generators');
      container.innerHTML = '';
      
      generators.forEach(generator => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${generator.immatriculation}</td>
          <td>${generator.marque}</td>
          <td>${generator.puissance} kVA</td>
          <td>${formatGeneratorType(generator.type)}</td>
          <td>${formatStatus(generator.statut)}</td>
          <td>
            <button class="btn btn-sm btn-outline edit-generator" data-id="${generator.id}"><i class="fas fa-edit"></i></button>
            <button class="btn btn-sm btn-outline view-generator" data-id="${generator.id}"><i class="fas fa-eye"></i></button>
            <button class="btn btn-sm btn-outline delete-generator" data-id="${generator.id}"><i class="fas fa-trash"></i></button>
          </td>
        `;
        container.appendChild(tr);
      });
      
      document.getElementById('generator-count').textContent = `${generators.length} groupe${generators.length !== 1 ? 's' : ''} √©lectrog√®ne${generators.length !== 1 ? 's' : ''}`;
      
      // Attach event listeners
      document.querySelectorAll('.edit-generator').forEach(btn => {
        btn.addEventListener('click', () => editGenerator(btn.getAttribute('data-id')));
      });
      
      document.querySelectorAll('.view-generator').forEach(btn => {
        btn.addEventListener('click', () => viewGenerator(btn.getAttribute('data-id')));
      });
      
      document.querySelectorAll('.delete-generator').forEach(btn => {
        btn.addEventListener('click', () => deleteGenerator(btn.getAttribute('data-id')));
      });
      
      // Update generator dropdown in fuel form
      populateGeneratorDropdown();
      populateGeneratorMaintenanceDropdown();
    }

    function renderHistory() {
      const container = document.getElementById('historique');
      container.innerHTML = '';
      
      const allHistory = [
        ...vehicles.map(vehicle => ({
          type: 'vehicle',
          date: vehicle.last_updated,
          content: `V√©hicule ${vehicle.immatriculation} mis √† jour - Statut: ${formatStatus(vehicle.statut)}`,
          vehicle_id: vehicle.id
        })),
        ...fuelRecords.map(fuel => ({
          type: 'fuel',
          date: fuel.created_at,
          content: `Ravitaillement de ${fuel.litres}L (${fuel.type}) pour ${getVehicleImmat(fuel.vehicle_id)} - ${fuel.km_parcouru} km parcourus - Consommation: ${fuel.consommation_100km}L/100km - Co√ªt: ${formatCurrency(fuel.cout)}`,
          vehicle_id: fuel.vehicle_id
        })),
        ...vehicleMaintenance.map(maint => ({
          type: 'maintenance',
          date: maint.created_at,
          content: `Maintenance ${formatMaintenanceType(maint.type)} effectu√©e sur ${getVehicleImmat(maint.vehicle_id)} - Co√ªt: ${formatCurrency(maint.cout)}`,
          vehicle_id: maint.vehicle_id
        }))
      ];
      
      allHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      const filterType = document.getElementById('filter-type').value;
      const filteredHistory = filterType === 'all' 
        ? allHistory 
        : allHistory.filter(item => item.type === filterType);
      
      filteredHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'timeline-item';
        div.innerHTML = `
          <div class="timeline-date">${formatDate(item.date)}</div>
          <div class="timeline-content">${item.content}</div>
        `;
        container.appendChild(div);
      });
    }

    function renderBikeHistory() {
      const container = document.getElementById('bike-history');
      container.innerHTML = '';
      
      const allHistory = [
        ...bikes.map(bike => ({
          type: 'bike',
          date: bike.last_updated,
          content: `Moto ${bike.immatriculation} mise √† jour - Statut: ${formatStatus(bike.statut)}`,
          bike_id: bike.id
        })),
        ...bikeMaintenance.map(maint => ({
          type: 'maintenance',
          date: maint.created_at,
          content: `Maintenance ${formatMaintenanceType(maint.type)} effectu√©e sur ${getBikeImmat(maint.bike_id)} - Co√ªt: ${formatCurrency(maint.cout)}`,
          bike_id: maint.bike_id
        })),
        ...bikeFuelRecords.map(fuel => ({
          type: 'fuel',
          date: fuel.created_at,
          content: `Ravitaillement de ${fuel.litres}L (${fuel.type}) pour ${getBikeImmat(fuel.bike_id)} - ${fuel.km_parcouru} km parcourus - Consommation: ${fuel.consommation_100km}L/100km - Co√ªt: ${formatCurrency(fuel.cout)}`,
          bike_id: fuel.bike_id
        }))
      ];
      
      allHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      const filterType = document.getElementById('bike-filter-type').value;
      const filteredHistory = filterType === 'all' 
        ? allHistory 
        : allHistory.filter(item => item.type === filterType);
      
      filteredHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'timeline-item';
        div.innerHTML = `
          <div class="timeline-date">${formatDate(item.date)}</div>
          <div class="timeline-content">${item.content}</div>
        `;
        container.appendChild(div);
      });
    }

    function renderGeneratorHistory() {
      const container = document.getElementById('generator-history');
      container.innerHTML = '';
      
      const allHistory = [
        ...generators.map(generator => ({
          type: 'generator',
          date: generator.last_updated,
          content: `Groupe √©lectrog√®ne ${generator.immatriculation} mis √† jour - Statut: ${formatStatus(generator.statut)}`,
          generator_id: generator.id
        })),
        ...generatorFuelRecords.map(fuel => ({
          type: 'fuel',
          date: fuel.created_at,
          content: `Ravitaillement de ${fuel.quantite_ravitailler}L pour ${getGeneratorImmat(fuel.generator_id)} - ${fuel.temps_fonctionnement} de fonctionnement - Consommation: ${fuel.quantite_consommee_heure} L/h - Co√ªt: ${formatCurrency(fuel.cout)}`,
          generator_id: fuel.generator_id
        })),
        ...generatorMaintenance.map(maint => ({
          type: 'maintenance',
          date: maint.created_at,
          content: `Maintenance ${formatGeneratorMaintenanceType(maint.type)} effectu√©e sur ${getGeneratorImmat(maint.generator_id)} - Co√ªt: ${formatCurrency(maint.cout)}`,
          generator_id: maint.generator_id
        }))
      ];
      
      allHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      const filterType = document.getElementById('generator-filter-type').value;
      const filteredHistory = filterType === 'all' 
        ? allHistory 
        : allHistory.filter(item => item.type === filterType);
      
      filteredHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'timeline-item';
        div.innerHTML = `
          <div class="timeline-date">${formatDate(item.date)}</div>
          <div class="timeline-content">${item.content}</div>
        `;
        container.appendChild(div);
      });
    }

    // Helper Functions
    function formatVehicleType(type) {
      const types = {
        'voiture': 'Voiture',
        'camion': 'Camion',
        'bus': 'Bus',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatBikeType(type) {
      const types = {
        'moto_cross': 'Moto Cross',
        'moto_routiere': 'Moto Routi√®re',
        'scooter': 'Scooter',
        'tricycle': 'Tricycle',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatGeneratorType(type) {
      const types = {
        'diesel': 'Diesel',
        'essence': 'Essence',
        'gaz': 'Gaz',
        'autre': 'Autre'
      };
      return types[type] || type;
    }

    function formatMaintenanceType(type) {
      const types = {
        'entretien_kilometrique': 'Entretien kilom√©trique',
        'freins': 'Freins',
        'pneus': 'Pneus',
        'climatisation': 'Climatisation',
        'electrique': 'Probl√®me √©lectrique',
        'moteur': 'Probl√®me de moteur',
        'carrosserie': 'Probl√®me de carrosserie',
        'suspension': 'Probl√®me de suspension',
        'autre': 'Autre maintenance'
      };
      return types[type] || type;
    }

    // NOUVELLE FONCTION : Format Generator Maintenance Type
    function formatGeneratorMaintenanceType(type) {
      const types = {
        'entretien_preventif': 'Entretien pr√©ventif',
        'entretien_correctif': 'Entretien correctif',
        'changement_filtres': 'Changement des filtres',
        'vidange_huile': 'Vidange d\'huile',
        'nettoyage_injecteurs': 'Nettoyage injecteurs',
        'revision_moteur': 'R√©vision moteur',
        'controle_electrique': 'Contr√¥le √©lectrique',
        'changement_batterie': 'Changement batterie',
        'autre': 'Autre maintenance'
      };
      return types[type] || type;
    }

    function formatStatus(status) {
      return status.charAt(0).toUpperCase() + status.slice(1);
    }

    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      return new Date(dateString).toLocaleDateString('fr-FR', options);
    }
    
    function formatCurrency(amount) {
      return Number(amount).toLocaleString('fr-GN', {
        style: 'currency',
        currency: 'GNF',
        minimumFractionDigits: 0
      });
    }

    function getVehicleImmat(id) {
      const vehicle = vehicles.find(v => v.id === id);
      return vehicle ? vehicle.immatriculation : '[V√©hicule inconnu]';
    }

    function getBikeImmat(id) {
      const bike = bikes.find(b => b.id === id);
      return bike ? bike.immatriculation : '[Moto inconnue]';
    }

    function getGeneratorImmat(id) {
      const generator = generators.find(g => g.id === id);
      return generator ? generator.immatriculation : '[Groupe inconnu]';
    }

    // Populate Dropdowns
    function populateVehicleDropdown() {
      const select = document.getElementById('carburant_vehicule');
      select.innerHTML = '<option value="">S√©lectionner un v√©hicule...</option>';
      
      vehicles.forEach(vehicle => {
        const option = document.createElement('option');
        option.value = vehicle.id;
        option.textContent = `${vehicle.immatriculation} - ${vehicle.marque}`;
        select.appendChild(option);
      });
    }
    
    function populateVehicleMaintenanceDropdown() {
      const select = document.getElementById('vehicle_maintenance_vehicule');
      select.innerHTML = '<option value="">S√©lectionner un v√©hicule...</option>';
      
      vehicles.forEach(vehicle => {
        const option = document.createElement('option');
        option.value = vehicle.id;
        option.textContent = `${vehicle.immatriculation} - ${vehicle.marque}`;
        select.appendChild(option);
      });
    }

    function populateBikeDropdown() {
      const maintenanceSelect = document.getElementById('maintenance_bike');
      maintenanceSelect.innerHTML = '<option value="">S√©lectionner une moto...</option>';
      
      const fuelSelect = document.getElementById('bike_carburant_moto');
      fuelSelect.innerHTML = '<option value="">S√©lectionner une moto...</option>';
      
      bikes.forEach(bike => {
        const maintenanceOption = document.createElement('option');
        maintenanceOption.value = bike.id;
        maintenanceOption.textContent = `${bike.immatriculation} - ${bike.marque}`;
        maintenanceSelect.appendChild(maintenanceOption);
        
        const fuelOption = document.createElement('option');
        fuelOption.value = bike.id;
        fuelOption.textContent = `${bike.immatriculation} - ${bike.marque}`;
        fuelSelect.appendChild(fuelOption);
      });
    }

    function populateGeneratorDropdown() {
      const select = document.getElementById('generator_carburant_groupe');
      select.innerHTML = '<option value="">S√©lectionner un groupe...</option>';
      
      generators.forEach(generator => {
        const option = document.createElement('option');
        option.value = generator.id;
        option.textContent = `${generator.immatriculation} - ${generator.marque}`;
        select.appendChild(option);
      });
    }

    // NOUVELLE FONCTION : Populate Generator Maintenance Dropdown
    function populateGeneratorMaintenanceDropdown() {
      const select = document.getElementById('generator_maintenance_groupe');
      select.innerHTML = '<option value="">S√©lectionner un groupe...</option>';
      
      generators.forEach(generator => {
        const option = document.createElement('option');
        option.value = generator.id;
        option.textContent = `${generator.immatriculation} - ${generator.marque}`;
        select.appendChild(option);
      });
    }

    // CRUD Operations for Vehicles
    function editVehicle(id) {
      const vehicle = vehicles.find(v => v.id === id);
      if (!vehicle) return;
      
      document.getElementById('immatriculation').value = vehicle.immatriculation;
      document.getElementById('marque').value = vehicle.marque;
      document.getElementById('type').value = vehicle.type;
      // Formater la date pour l'affichage dans le format JJ MM AAAA
      document.getElementById('date_circulation').value = formatForDisplay(vehicle.date_circulation);
      document.getElementById('statut').value = vehicle.statut;
      document.getElementById('chauffeur').value = vehicle.chauffeur;
      document.getElementById('observations').value = vehicle.observations;
      document.getElementById('departement').value = vehicle.departement || '';
      document.getElementById('destination').value = vehicle.destination || '';
      document.getElementById('motif_deplacement').value = vehicle.motif_deplacement || '';
      document.getElementById('km_avant').value = vehicle.km_avant || '';
      document.getElementById('km_apres').value = vehicle.km_apres || '';
      document.getElementById('km_parcouru').value = vehicle.km_parcouru || '';
      
      document.getElementById('vehicule-form').setAttribute('data-edit-id', vehicle.id);
      document.getElementById('form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function viewVehicle(id) {
      const vehicle = vehicles.find(v => v.id === id);
      if (!vehicle) return;
      
      const fuelRecordsForVehicle = fuelRecords.filter(f => f.vehicle_id === id);
      const maintenanceRecords = vehicleMaintenance.filter(m => m.vehicle_id === id);
      
      document.getElementById('modal-title').textContent = `D√©tails: ${vehicle.immatriculation}`;
      
      // Formater la date pour l'affichage
      const formattedDate = formatToFrenchDate(vehicle.date_circulation);
      
      let html = `
        <div class="vehicle-details-grid">
          <div class="detail-item">
            <span class="detail-label">Marque/Mod√®le:</span>
            <span class="detail-value">${vehicle.marque}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Type:</span>
            <span class="detail-value">${formatVehicleType(vehicle.type)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Mise en circulation:</span>
            <span class="detail-value">${formattedDate}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut:</span>
            <span class="detail-value">${formatStatus(vehicle.statut)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Chauffeur:</span>
            <span class="detail-value">${vehicle.chauffeur || 'Non assign√©'}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">D√©partement:</span>
            <span class="detail-value">${vehicle.departement || 'Non sp√©cifi√©'}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">Observations:</span>
            <span class="detail-value">${vehicle.observations || 'Aucune'}</span>
          </div>
        </div>
      `;
      
      // Ajouter les informations de d√©placement si elles existent
      if (vehicle.destination) {
        html += `
          <h4 class="maintenance-title">D√©tails du D√©placement</h4>
          <div class="maintenance-item">
            <div class="maintenance-header">
              <span class="maintenance-type">Destination: ${vehicle.destination}</span>
              <span class="maintenance-date">Motif: ${vehicle.motif_deplacement || 'Non sp√©cifi√©'}</span>
            </div>
            <div class="maintenance-cost">Kilom√©trage avant: ${vehicle.km_avant || 'N/A'} km</div>
            <div class="maintenance-cost">Kilom√©trage apr√®s: ${vehicle.km_apres || 'N/A'} km</div>
            <div class="maintenance-cost">Distance parcourue: ${vehicle.km_parcouru || 'N/A'} km</div>
          </div>
        `;
      }
      
      if (fuelRecordsForVehicle.length > 0) {
        html += `
          <h4 class="fuel-title">Historique de ravitaillement</h4>
          <div class="fuel-list">
            ${fuelRecordsForVehicle.map(fuel => `
              <div class="fuel-item">
                <div class="fuel-header">
                  <span class="fuel-type">${fuel.type}</span>
                  <span class="fuel-date">${formatDate(fuel.date)}</span>
                </div>
                <div class="fuel-quantity">Quantit√©: ${fuel.litres}L</div>
                <div class="fuel-cost">Distance: ${fuel.km_parcouru} km</div>
                <div class="fuel-cost">Consommation: ${fuel.consommation_100km}L/100km</div>
                <div class="fuel-cost">Co√ªt: ${formatCurrency(fuel.cout)}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      if (maintenanceRecords.length > 0) {
        html += `
          <h4 class="maintenance-title">Historique de maintenance</h4>
          <div class="maintenance-list">
            ${maintenanceRecords.map(maint => `
              <div class="maintenance-item">
                <div class="maintenance-header">
                  <span class="maintenance-type">${formatMaintenanceType(maint.type)}</span>
                  <span class="maintenance-date">${formatDate(maint.date)}</span>
                </div>
                <div class="maintenance-cost">Co√ªt: ${formatCurrency(maint.cout)}</div>
                <div class="maintenance-description">${maint.description || 'Aucune description'}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      document.getElementById('vehicle-details').innerHTML = html;
      document.getElementById('vehicle-modal').classList.add('show');
    }

    function deleteVehicle(id) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer ce v√©hicule ? Cette action est irr√©versible.')) {
        vehicles = vehicles.filter(v => v.id !== id);
        fuelRecords = fuelRecords.filter(f => f.vehicle_id !== id);
        vehicleMaintenance = vehicleMaintenance.filter(m => m.vehicle_id !== id);
        saveVehicles();
        saveFuelRecords();
        saveVehicleMaintenance();
        renderVehiclesList();
        renderHistory();
        showToast('V√©hicule supprim√© avec succ√®s', 'success');
      }
    }

    // CRUD Operations for Bikes
    function editBike(id) {
      const bike = bikes.find(b => b.id === id);
      if (!bike) return;
      
      document.getElementById('bike_immatriculation').value = bike.immatriculation;
      document.getElementById('bike_marque').value = bike.marque;
      document.getElementById('bike_type').value = bike.type;
      // Formater la date pour l'affichage dans le format JJ MM AAAA
      document.getElementById('bike_date_circulation').value = formatForDisplay(bike.date_circulation);
      document.getElementById('bike_statut').value = bike.statut;
      document.getElementById('bike_chauffeur').value = bike.chauffeur;
      document.getElementById('bike_observations').value = bike.observations;
      
      document.getElementById('bike-form').setAttribute('data-edit-id', bike.id);
      document.getElementById('bike-form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function viewBike(id) {
      const bike = bikes.find(b => b.id === id);
      if (!bike) return;
      
      const maintenanceRecords = bikeMaintenance.filter(m => m.bike_id === id);
      const fuelRecordsForBike = bikeFuelRecords.filter(f => f.bike_id === id);
      
      document.getElementById('bike-modal-title').textContent = `D√©tails: ${bike.immatriculation}`;
      
      // Formater la date pour l'affichage
      const formattedDate = formatToFrenchDate(bike.date_circulation);
      
      let html = `
        <div class="bike-details-grid">
          <div class="detail-item">
            <span class="detail-label">Marque/Mod√®le:</span>
            <span class="detail-value">${bike.marque}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Type:</span>
            <span class="detail-value">${formatBikeType(bike.type)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Mise en circulation:</span>
            <span class="detail-value">${formattedDate}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut:</span>
            <span class="detail-value bike-status ${bike.statut.replace(' ', '-')}">${formatStatus(bike.statut)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Livreur:</span>
            <span class="detail-value">${bike.chauffeur || 'Non assign√©'}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">Observations:</span>
            <span class="detail-value">${bike.observations || 'Aucune'}</span>
          </div>
        </div>
      `;
      
      if (fuelRecordsForBike.length > 0) {
        html += `
          <h4 class="fuel-title">Historique de ravitaillement</h4>
          <div class="fuel-list">
            ${fuelRecordsForBike.map(fuel => `
              <div class="fuel-item">
                <div class="fuel-header">
                  <span class="fuel-type">${fuel.type}</span>
                  <span class="fuel-date">${formatDate(fuel.date)}</span>
                </div>
                <div class="fuel-quantity">Quantit√©: ${fuel.litres}L</div>
                <div class="fuel-cost">Distance: ${fuel.km_parcouru} km</div>
                <div class="fuel-cost">Consommation: ${fuel.consommation_100km}L/100km</div>
                <div class="fuel-cost">Co√ªt: ${formatCurrency(fuel.cout)}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      if (maintenanceRecords.length > 0) {
        html += `
          <h4 class="maintenance-title">Historique de maintenance</h4>
          <div class="maintenance-list">
            ${maintenanceRecords.map(maint => `
              <div class="maintenance-item">
                <div class="maintenance-header">
                  <span class="maintenance-type">${formatMaintenanceType(maint.type)}</span>
                  <span class="maintenance-date">${formatDate(maint.date)}</span>
                </div>
                <div class="maintenance-cost">Co√ªt: ${formatCurrency(maint.cout)}</div>
                <div class="maintenance-description">${maint.description || 'Aucune description'}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      document.getElementById('bike-details').innerHTML = html;
      document.getElementById('bike-modal').classList.add('show');
    }

    function deleteBike(id) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cette moto ? Cette action est irr√©versible.')) {
        bikes = bikes.filter(b => b.id !== id);
        bikeMaintenance = bikeMaintenance.filter(m => m.bike_id !== id);
        bikeFuelRecords = bikeFuelRecords.filter(f => f.bike_id !== id);
        saveBikes();
        saveBikeMaintenance();
        saveBikeFuelRecords();
        renderBikesList();
        renderBikeHistory();
        showToast('Moto supprim√©e avec succ√®s', 'success');
      }
    }

    // CRUD Operations for Generators
    function editGenerator(id) {
      const generator = generators.find(g => g.id === id);
      if (!generator) return;
      
      document.getElementById('generator_immatriculation').value = generator.immatriculation;
      document.getElementById('generator_marque').value = generator.marque;
      document.getElementById('generator_type').value = generator.type;
      document.getElementById('generator_puissance').value = generator.puissance;
      // Formater la date pour l'affichage dans le format JJ MM AAAA
      document.getElementById('generator_date_mise_service').value = formatForDisplay(generator.date_mise_service);
      document.getElementById('generator_statut').value = generator.statut;
      document.getElementById('generator_observations').value = generator.observations;
      
      document.getElementById('generator-form').setAttribute('data-edit-id', generator.id);
      document.getElementById('generator-form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function viewGenerator(id) {
      const generator = generators.find(g => g.id === id);
      if (!generator) return;
      
      const fuelRecordsForGenerator = generatorFuelRecords.filter(f => f.generator_id === id);
      const maintenanceRecords = generatorMaintenance.filter(m => m.generator_id === id);
      
      document.getElementById('generator-modal-title').textContent = `D√©tails: ${generator.immatriculation}`;
      
      // Formater la date pour l'affichage
      const formattedDate = formatToFrenchDate(generator.date_mise_service);
      
      let html = `
        <div class="generator-details-grid">
          <div class="detail-item">
            <span class="detail-label">Marque/Mod√®le:</span>
            <span class="detail-value">${generator.marque}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Type:</span>
            <span class="detail-value">${formatGeneratorType(generator.type)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Puissance:</span>
            <span class="detail-value">${generator.puissance} kVA</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Mise en service:</span>
            <span class="detail-value">${formattedDate}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut:</span>
            <span class="detail-value">${formatStatus(generator.statut)}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">Observations:</span>
            <span class="detail-value">${generator.observations || 'Aucune'}</span>
          </div>
        </div>
      `;
      
      if (fuelRecordsForGenerator.length > 0) {
        html += `
          <h4 class="fuel-title">Historique de ravitaillement</h4>
          <div class="fuel-list">
            ${fuelRecordsForGenerator.map(fuel => `
              <div class="fuel-item">
                <div class="fuel-header">
                  <span class="fuel-date">${formatDate(fuel.date)} - Allumage: ${fuel.heure_allumage} - Extinction: ${fuel.heure_extinction}</span>
                </div>
                <div class="fuel-quantity">Quantit√© ravitaill√©e: ${fuel.quantite_ravitailler}L</div>
                <div class="fuel-cost">Temps fonctionnement: ${fuel.temps_fonctionnement}</div>
                <div class="fuel-cost">Consommation: ${fuel.quantite_consommee_heure} L/h</div>
                <div class="fuel-cost">Co√ªt: ${formatCurrency(fuel.cout)}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      if (maintenanceRecords.length > 0) {
        html += `
          <h4 class="maintenance-title">Historique de maintenance</h4>
          <div class="maintenance-list">
            ${maintenanceRecords.map(maint => `
              <div class="maintenance-item">
                <div class="maintenance-header">
                  <span class="maintenance-type">${formatGeneratorMaintenanceType(maint.type)}</span>
                  <span class="maintenance-date">${formatDate(maint.date)}</span>
                </div>
                <div class="maintenance-cost">Co√ªt: ${formatCurrency(maint.cout)}</div>
                <div class="maintenance-description">${maint.description || 'Aucune description'}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      document.getElementById('generator-details').innerHTML = html;
      document.getElementById('generator-modal').classList.add('show');
    }

    function deleteGenerator(id) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer ce groupe √©lectrog√®ne ? Cette action est irr√©versible.')) {
        generators = generators.filter(g => g.id !== id);
        generatorFuelRecords = generatorFuelRecords.filter(f => f.generator_id !== id);
        generatorMaintenance = generatorMaintenance.filter(m => m.generator_id !== id);
        saveGenerators();
        saveGeneratorFuelRecords();
        saveGeneratorMaintenance();
        renderGeneratorsList();
        renderGeneratorHistory();
        showToast('Groupe √©lectrog√®ne supprim√© avec succ√®s', 'success');
      }
    }

    // Modal Handling
    function closeModal() {
      document.querySelectorAll('.modal').forEach(modal => {
        modal.classList.remove('show');
      });
    }

    document.querySelectorAll('.close-modal').forEach(btn => {
      btn.addEventListener('click', closeModal);
    });

    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === this) closeModal();
      });
    });

    // Toast Notification
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast show ${type}`;
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Search Functionality
    document.getElementById('search-vehicule').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const rows = document.querySelectorAll('#vehicules-table tbody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    });

    document.getElementById('search-bike').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const rows = document.querySelectorAll('#bikes-table tbody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    });

    document.getElementById('search-generator').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const rows = document.querySelectorAll('#generators-table tbody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    });

    // Filter Event Listeners
    document.getElementById('filter-type').addEventListener('change', renderHistory);
    document.getElementById('bike-filter-type').addEventListener('change', renderBikeHistory);
    document.getElementById('generator-filter-type').addEventListener('change', renderGeneratorHistory);

    // Auto-calculation for fuel forms MODIFI√â
    function setupAutoCalculations() {
      // Vehicle fuel calculations
      document.getElementById('carburant_km_depart').addEventListener('input', calculateVehicleFuel);
      document.getElementById('carburant_km_arrivee').addEventListener('input', calculateVehicleFuel);
      document.getElementById('carburant_litres').addEventListener('input', calculateVehicleFuel);
      document.getElementById('carburant_prix_unitaire').addEventListener('input', calculateVehicleFuel);
      
      // Bike fuel calculations
      document.getElementById('bike_carburant_km_depart').addEventListener('input', calculateBikeFuel);
      document.getElementById('bike_carburant_km_arrivee').addEventListener('input', calculateBikeFuel);
      document.getElementById('bike_carburant_litres').addEventListener('input', calculateBikeFuel);
      document.getElementById('bike_carburant_prix_unitaire').addEventListener('input', calculateBikeFuel);
      
      // Generator fuel calculations MODIFI√â (seulement le co√ªt total)
      document.getElementById('generator_carburant_quantite_ravitailler').addEventListener('input', calculateGeneratorFuel);
      document.getElementById('generator_carburant_prix_unitaire').addEventListener('input', calculateGeneratorFuel);
    }

    function calculateVehicleFuel() {
      const kmDepart = parseFloat(document.getElementById('carburant_km_depart').value) || 0;
      const kmArrivee = parseFloat(document.getElementById('carburant_km_arrivee').value) || 0;
      const litres = parseFloat(document.getElementById('carburant_litres').value) || 0;
      const prixUnitaire = parseFloat(document.getElementById('carburant_prix_unitaire').value) || 0;
      
      const kmParcouru = kmArrivee - kmDepart;
      const coutTotal = litres * prixUnitaire;
      
      document.getElementById('carburant_km_parcouru').value = kmParcouru > 0 ? kmParcouru : '';
      document.getElementById('carburant_cout').value = coutTotal > 0 ? coutTotal.toFixed(2) : '';
    }

    function calculateBikeFuel() {
      const kmDepart = parseFloat(document.getElementById('bike_carburant_km_depart').value) || 0;
      const kmArrivee = parseFloat(document.getElementById('bike_carburant_km_arrivee').value) || 0;
      const litres = parseFloat(document.getElementById('bike_carburant_litres').value) || 0;
      const prixUnitaire = parseFloat(document.getElementById('bike_carburant_prix_unitaire').value) || 0;
      
      const kmParcouru = kmArrivee - kmDepart;
      const coutTotal = litres * prixUnitaire;
      
      document.getElementById('bike_carburant_km_parcouru').value = kmParcouru > 0 ? kmParcouru : '';
      document.getElementById('bike_carburant_cout').value = coutTotal > 0 ? coutTotal.toFixed(2) : '';
    }

    // MODIFI√â : Supprimer les calculs automatiques pour les g√©n√©rateurs
    function calculateGeneratorFuel() {
      const quantiteRavitailler = parseFloat(document.getElementById('generator_carburant_quantite_ravitailler').value) || 0;
      const prixUnitaire = parseFloat(document.getElementById('generator_carburant_prix_unitaire').value) || 0;
      
      const coutTotal = quantiteRavitailler * prixUnitaire;
      
      document.getElementById('generator_carburant_cout').value = coutTotal > 0 ? coutTotal.toFixed(2) : '';
    }

    // Export to Excel
    document.getElementById('export-excel').addEventListener('click', function() {
      // Create workbook with all data
      const wb = XLSX.utils.book_new();
      
      // Vehicles sheet
      const vehicleData = vehicles.map(v => ({
        'Immatriculation': v.immatriculation,
        'Marque/Mod√®le': v.marque,
        'Type': formatVehicleType(v.type),
        'Date circulation': formatToFrenchDate(v.date_circulation),
        'Statut': formatStatus(v.statut),
        'Chauffeur': v.chauffeur || '',
        'D√©partement': v.departement || '',
        'Destination': v.destination || '',
        'Motif d√©placement': v.motif_deplacement || '',
        'Km avant': v.km_avant || '',
        'Km apr√®s': v.km_apres || '',
        'Km parcouru': v.km_parcouru || '',
        'Observations': v.observations || ''
      }));
      
      const vehicleWS = XLSX.utils.json_to_sheet(vehicleData);
      XLSX.utils.book_append_sheet(wb, vehicleWS, "V√©hicules");
      
      // Bikes sheet
      const bikeData = bikes.map(b => ({
        'Immatriculation': b.immatriculation,
        'Marque/Mod√®le': b.marque,
        'Type': formatBikeType(b.type),
        'Date circulation': formatToFrenchDate(b.date_circulation),
        'Statut': formatStatus(b.statut),
        'Livreur': b.chauffeur || '',
        'Observations': b.observations || ''
      }));
      
      const bikeWS = XLSX.utils.json_to_sheet(bikeData);
      XLSX.utils.book_append_sheet(wb, bikeWS, "Motos");
      
      // Generators sheet
      const generatorData = generators.map(g => ({
        'N¬∞ Inventaire': g.immatriculation,
        'Marque/Mod√®le': g.marque,
        'Type': formatGeneratorType(g.type),
        'Puissance (kVA)': g.puissance,
        'Date mise service': formatToFrenchDate(g.date_mise_service),
        'Statut': formatStatus(g.statut),
        'Observations': g.observations || ''
      }));
      
      const generatorWS = XLSX.utils.json_to_sheet(generatorData);
      XLSX.utils.book_append_sheet(wb, generatorWS, "Groupes √âlectrog√®nes");
      
      // Vehicle maintenance sheet
      if (vehicleMaintenance.length > 0) {
        const vehicleMaintenanceData = vehicleMaintenance.map(m => {
          const vehicle = vehicles.find(v => v.id === m.vehicle_id) || {};
          return {
            'V√©hicule': vehicle.immatriculation || 'Inconnu',
            'Date': formatToFrenchDate(m.date),
            'Type': formatMaintenanceType(m.type),
            'Co√ªt': m.cout,
            'Description': m.description || ''
          };
        });
        
        const vehicleMaintenanceWS = XLSX.utils.json_to_sheet(vehicleMaintenanceData);
        XLSX.utils.book_append_sheet(wb, vehicleMaintenanceWS, "Maintenance V√©hicules");
      }
      
      // Bike maintenance sheet
      if (bikeMaintenance.length > 0) {
        const bikeMaintenanceData = bikeMaintenance.map(m => {
          const bike = bikes.find(b => b.id === m.bike_id) || {};
          return {
            'Moto': bike.immatriculation || 'Inconnu',
            'Date': formatToFrenchDate(m.date),
            'Type': formatMaintenanceType(m.type),
            'Co√ªt': m.cout,
            'Description': m.description || ''
          };
        });
        
        const bikeMaintenanceWS = XLSX.utils.json_to_sheet(bikeMaintenanceData);
        XLSX.utils.book_append_sheet(wb, bikeMaintenanceWS, "Maintenance Motos");
      }
      
      // Generator maintenance sheet
      if (generatorMaintenance.length > 0) {
        const generatorMaintenanceData = generatorMaintenance.map(m => {
          const generator = generators.find(g => g.id === m.generator_id) || {};
          return {
            'Groupe': generator.immatriculation || 'Inconnu',
            'Date': formatToFrenchDate(m.date),
            'Type': formatGeneratorMaintenanceType(m.type),
            'Co√ªt': m.cout,
            'Description': m.description || ''
          };
        });
        
        const generatorMaintenanceWS = XLSX.utils.json_to_sheet(generatorMaintenanceData);
        XLSX.utils.book_append_sheet(wb, generatorMaintenanceWS, "Maintenance Groupes");
      }
      
      // Vehicle fuel sheet
      if (fuelRecords.length > 0) {
        const vehicleFuelData = fuelRecords.map(f => {
          const vehicle = vehicles.find(v => v.id === f.vehicle_id) || {};
          return {
            'V√©hicule': vehicle.immatriculation || 'Inconnu',
            'Date': formatToFrenchDate(f.date),
            'Km d√©part': f.km_depart,
            'Km arriv√©e station': f.km_arrivee,
            'Km parcouru': f.km_parcouru,
            'Type carburant': f.type,
            'Quantit√© (L)': f.litres,
            'Consommation 100km': f.consommation_100km,
            'Prix unitaire': f.prix_unitaire,
            'Co√ªt total': f.cout
          };
        });
        
        const vehicleFuelWS = XLSX.utils.json_to_sheet(vehicleFuelData);
        XLSX.utils.book_append_sheet(wb, vehicleFuelWS, "Carburant V√©hicules");
      }
      
      // Bike fuel sheet
      if (bikeFuelRecords.length > 0) {
        const bikeFuelData = bikeFuelRecords.map(f => {
          const bike = bikes.find(b => b.id === f.bike_id) || {};
          return {
            'Moto': bike.immatriculation || 'Inconnu',
            'Date': formatToFrenchDate(f.date),
            'Km d√©part': f.km_depart,
            'Km arriv√©e station': f.km_arrivee,
            'Km parcouru': f.km_parcouru,
            'Type carburant': f.type,
            'Quantit√© (L)': f.litres,
            'Consommation 100km': f.consommation_100km,
            'Prix unitaire': f.prix_unitaire,
            'Co√ªt total': f.cout
          };
        });
        
        const bikeFuelWS = XLSX.utils.json_to_sheet(bikeFuelData);
        XLSX.utils.book_append_sheet(wb, bikeFuelWS, "Carburant Motos");
      }
      
      // Generator fuel sheet MODIFI√â
      if (generatorFuelRecords.length > 0) {
        const generatorFuelData = generatorFuelRecords.map(f => {
          const generator = generators.find(g => g.id === f.generator_id) || {};
          return {
            'Groupe': generator.immatriculation || 'Inconnu',
            'Date': formatToFrenchDate(f.date),
            'Quantit√© ravitaill√©e (L)': f.quantite_ravitailler,
            'Heure allumage': f.heure_allumage,
            'Heure extinction': f.heure_extinction,
            'Temps fonctionnement': f.temps_fonctionnement,
            'Quantit√© consomm√©e/h (L/h)': f.quantite_consommee_heure,
            'Prix unitaire': f.prix_unitaire,
            'Co√ªt total': f.cout
          };
        });
        
        const generatorFuelWS = XLSX.utils.json_to_sheet(generatorFuelData);
        XLSX.utils.book_append_sheet(wb, generatorFuelWS, "Carburant Groupes");
      }
      
      // Export the workbook
      XLSX.writeFile(wb, "gestion_flotte.xlsx");
      showToast('Export Excel r√©ussi', 'success');
    });

    // Initialize the App
    function initApp() {
      renderVehiclesList();
      renderHistory();
      renderBikesList();
      renderBikeHistory();
      renderGeneratorsList();
      renderGeneratorHistory();
      populateVehicleDropdown();
      populateBikeDropdown();
      populateGeneratorDropdown();
      populateGeneratorMaintenanceDropdown();
      setupAutoCalculations();
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
